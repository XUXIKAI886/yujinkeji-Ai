[2025-01-04 14:19:18.922] ERROR: uncaughtException: Cannot find module '../models/pointRecord.model'
Require stack:
- /home/devbox/project/server/controllers/user.controller.js
- /home/devbox/project/server/routes/auth.routes.js
- /home/devbox/project/server/app.js
Error: Cannot find module '../models/pointRecord.model'
Require stack:
- /home/devbox/project/server/controllers/user.controller.js
- /home/devbox/project/server/routes/auth.routes.js
- /home/devbox/project/server/app.js
    at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)
    at Function._load (node:internal/modules/cjs/loader:1075:27)
    at TracingChannel.traceSync (node:diagnostics_channel:315:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:218:24)
    at Module.require (node:internal/modules/cjs/loader:1340:12)
    at require (node:internal/modules/helpers:141:16)
    at Object.<anonymous> (/home/devbox/project/server/controllers/user.controller.js:2:21)
    at Module._compile (node:internal/modules/cjs/loader:1546:14)
    at Object..js (node:internal/modules/cjs/loader:1689:10)
    at Module.load (node:internal/modules/cjs/loader:1318:32)
Details: {
  "metadata": {
    "error": {
      "code": "MODULE_NOT_FOUND",
      "requireStack": [
        "/home/devbox/project/server/controllers/user.controller.js",
        "/home/devbox/project/server/routes/auth.routes.js",
        "/home/devbox/project/server/app.js"
      ]
    },
    "stack": "Error: Cannot find module '../models/pointRecord.model'\nRequire stack:\n- /home/devbox/project/server/controllers/user.controller.js\n- /home/devbox/project/server/routes/auth.routes.js\n- /home/devbox/project/server/app.js\n    at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)\n    at Function._load (node:internal/modules/cjs/loader:1075:27)\n    at TracingChannel.traceSync (node:diagnostics_channel:315:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:218:24)\n    at Module.require (node:internal/modules/cjs/loader:1340:12)\n    at require (node:internal/modules/helpers:141:16)\n    at Object.<anonymous> (/home/devbox/project/server/controllers/user.controller.js:2:21)\n    at Module._compile (node:internal/modules/cjs/loader:1546:14)\n    at Object..js (node:internal/modules/cjs/loader:1689:10)\n    at Module.load (node:internal/modules/cjs/loader:1318:32)",
    "exception": true,
    "date": "Sat Jan 04 2025 14:19:18 GMT+0000 (Coordinated Universal Time)",
    "process": {
      "pid": 37644,
      "uid": 1000,
      "gid": 1000,
      "cwd": "/home/devbox/project",
      "execPath": "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
      "version": "v22.11.0",
      "argv": [
        "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
        "/home/devbox/project/server/app.js"
      ],
      "memoryUsage": {
        "rss": 85245952,
        "heapTotal": 34463744,
        "heapUsed": 21415776,
        "external": 20376369,
        "arrayBuffers": 18262288
      }
    },
    "os": {
      "loadavg": [
        1.6,
        1.73,
        1.95
      ],
      "uptime": 3743933.58
    },
    "trace": [
      {
        "column": 15,
        "file": "node:internal/modules/cjs/loader",
        "function": "Function._resolveFilename",
        "line": 1249,
        "method": "_resolveFilename",
        "native": false
      },
      {
        "column": 27,
        "file": "node:internal/modules/cjs/loader",
        "function": "Function._load",
        "line": 1075,
        "method": "_load",
        "native": false
      },
      {
        "column": 14,
        "file": "node:diagnostics_channel",
        "function": "TracingChannel.traceSync",
        "line": 315,
        "method": "traceSync",
        "native": false
      },
      {
        "column": 24,
        "file": "node:internal/modules/cjs/loader",
        "function": "wrapModuleLoad",
        "line": 218,
        "method": null,
        "native": false
      },
      {
        "column": 12,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module.require",
        "line": 1340,
        "method": "require",
        "native": false
      },
      {
        "column": 16,
        "file": "node:internal/modules/helpers",
        "function": "require",
        "line": 141,
        "method": null,
        "native": false
      },
      {
        "column": 21,
        "file": "/home/devbox/project/server/controllers/user.controller.js",
        "function": null,
        "line": 2,
        "method": null,
        "native": false
      },
      {
        "column": 14,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module._compile",
        "line": 1546,
        "method": "_compile",
        "native": false
      },
      {
        "column": 10,
        "file": "node:internal/modules/cjs/loader",
        "function": "Object..js",
        "line": 1689,
        "method": ".js",
        "native": false
      },
      {
        "column": 32,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module.load",
        "line": 1318,
        "method": "load",
        "native": false
      }
    ],
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:19:56.350] ERROR: uncaughtException: Cannot find module '../models/pointRecord.model'
Require stack:
- /home/devbox/project/server/controllers/user.controller.js
- /home/devbox/project/server/routes/auth.routes.js
- /home/devbox/project/server/app.js
Error: Cannot find module '../models/pointRecord.model'
Require stack:
- /home/devbox/project/server/controllers/user.controller.js
- /home/devbox/project/server/routes/auth.routes.js
- /home/devbox/project/server/app.js
    at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)
    at Function._load (node:internal/modules/cjs/loader:1075:27)
    at TracingChannel.traceSync (node:diagnostics_channel:315:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:218:24)
    at Module.require (node:internal/modules/cjs/loader:1340:12)
    at require (node:internal/modules/helpers:141:16)
    at Object.<anonymous> (/home/devbox/project/server/controllers/user.controller.js:2:21)
    at Module._compile (node:internal/modules/cjs/loader:1546:14)
    at Object..js (node:internal/modules/cjs/loader:1689:10)
    at Module.load (node:internal/modules/cjs/loader:1318:32)
Details: {
  "metadata": {
    "error": {
      "code": "MODULE_NOT_FOUND",
      "requireStack": [
        "/home/devbox/project/server/controllers/user.controller.js",
        "/home/devbox/project/server/routes/auth.routes.js",
        "/home/devbox/project/server/app.js"
      ]
    },
    "stack": "Error: Cannot find module '../models/pointRecord.model'\nRequire stack:\n- /home/devbox/project/server/controllers/user.controller.js\n- /home/devbox/project/server/routes/auth.routes.js\n- /home/devbox/project/server/app.js\n    at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)\n    at Function._load (node:internal/modules/cjs/loader:1075:27)\n    at TracingChannel.traceSync (node:diagnostics_channel:315:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:218:24)\n    at Module.require (node:internal/modules/cjs/loader:1340:12)\n    at require (node:internal/modules/helpers:141:16)\n    at Object.<anonymous> (/home/devbox/project/server/controllers/user.controller.js:2:21)\n    at Module._compile (node:internal/modules/cjs/loader:1546:14)\n    at Object..js (node:internal/modules/cjs/loader:1689:10)\n    at Module.load (node:internal/modules/cjs/loader:1318:32)",
    "exception": true,
    "date": "Sat Jan 04 2025 14:19:56 GMT+0000 (Coordinated Universal Time)",
    "process": {
      "pid": 37936,
      "uid": 1000,
      "gid": 1000,
      "cwd": "/home/devbox/project",
      "execPath": "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
      "version": "v22.11.0",
      "argv": [
        "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
        "/home/devbox/project/server/app.js"
      ],
      "memoryUsage": {
        "rss": 85684224,
        "heapTotal": 34201600,
        "heapUsed": 21526136,
        "external": 20376369,
        "arrayBuffers": 18262288
      }
    },
    "os": {
      "loadavg": [
        2.07,
        1.84,
        1.98
      ],
      "uptime": 3743971.01
    },
    "trace": [
      {
        "column": 15,
        "file": "node:internal/modules/cjs/loader",
        "function": "Function._resolveFilename",
        "line": 1249,
        "method": "_resolveFilename",
        "native": false
      },
      {
        "column": 27,
        "file": "node:internal/modules/cjs/loader",
        "function": "Function._load",
        "line": 1075,
        "method": "_load",
        "native": false
      },
      {
        "column": 14,
        "file": "node:diagnostics_channel",
        "function": "TracingChannel.traceSync",
        "line": 315,
        "method": "traceSync",
        "native": false
      },
      {
        "column": 24,
        "file": "node:internal/modules/cjs/loader",
        "function": "wrapModuleLoad",
        "line": 218,
        "method": null,
        "native": false
      },
      {
        "column": 12,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module.require",
        "line": 1340,
        "method": "require",
        "native": false
      },
      {
        "column": 16,
        "file": "node:internal/modules/helpers",
        "function": "require",
        "line": 141,
        "method": null,
        "native": false
      },
      {
        "column": 21,
        "file": "/home/devbox/project/server/controllers/user.controller.js",
        "function": null,
        "line": 2,
        "method": null,
        "native": false
      },
      {
        "column": 14,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module._compile",
        "line": 1546,
        "method": "_compile",
        "native": false
      },
      {
        "column": 10,
        "file": "node:internal/modules/cjs/loader",
        "function": "Object..js",
        "line": 1689,
        "method": ".js",
        "native": false
      },
      {
        "column": 32,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module.load",
        "line": 1318,
        "method": "load",
        "native": false
      }
    ],
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:21:25.352] ERROR: uncaughtException: Cannot find module '../models/pointRecord.model'
Require stack:
- /home/devbox/project/server/controllers/user.controller.js
- /home/devbox/project/server/routes/auth.routes.js
- /home/devbox/project/server/app.js
Error: Cannot find module '../models/pointRecord.model'
Require stack:
- /home/devbox/project/server/controllers/user.controller.js
- /home/devbox/project/server/routes/auth.routes.js
- /home/devbox/project/server/app.js
    at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)
    at Function._load (node:internal/modules/cjs/loader:1075:27)
    at TracingChannel.traceSync (node:diagnostics_channel:315:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:218:24)
    at Module.require (node:internal/modules/cjs/loader:1340:12)
    at require (node:internal/modules/helpers:141:16)
    at Object.<anonymous> (/home/devbox/project/server/controllers/user.controller.js:2:21)
    at Module._compile (node:internal/modules/cjs/loader:1546:14)
    at Object..js (node:internal/modules/cjs/loader:1689:10)
    at Module.load (node:internal/modules/cjs/loader:1318:32)
Details: {
  "metadata": {
    "error": {
      "code": "MODULE_NOT_FOUND",
      "requireStack": [
        "/home/devbox/project/server/controllers/user.controller.js",
        "/home/devbox/project/server/routes/auth.routes.js",
        "/home/devbox/project/server/app.js"
      ]
    },
    "stack": "Error: Cannot find module '../models/pointRecord.model'\nRequire stack:\n- /home/devbox/project/server/controllers/user.controller.js\n- /home/devbox/project/server/routes/auth.routes.js\n- /home/devbox/project/server/app.js\n    at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)\n    at Function._load (node:internal/modules/cjs/loader:1075:27)\n    at TracingChannel.traceSync (node:diagnostics_channel:315:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:218:24)\n    at Module.require (node:internal/modules/cjs/loader:1340:12)\n    at require (node:internal/modules/helpers:141:16)\n    at Object.<anonymous> (/home/devbox/project/server/controllers/user.controller.js:2:21)\n    at Module._compile (node:internal/modules/cjs/loader:1546:14)\n    at Object..js (node:internal/modules/cjs/loader:1689:10)\n    at Module.load (node:internal/modules/cjs/loader:1318:32)",
    "exception": true,
    "date": "Sat Jan 04 2025 14:21:25 GMT+0000 (Coordinated Universal Time)",
    "process": {
      "pid": 38252,
      "uid": 1000,
      "gid": 1000,
      "cwd": "/home/devbox/project",
      "execPath": "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
      "version": "v22.11.0",
      "argv": [
        "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
        "/home/devbox/project/server/app.js"
      ],
      "memoryUsage": {
        "rss": 84418560,
        "heapTotal": 34201600,
        "heapUsed": 20679912,
        "external": 20376369,
        "arrayBuffers": 18262288
      }
    },
    "os": {
      "loadavg": [
        1.23,
        1.61,
        1.88
      ],
      "uptime": 3744060.01
    },
    "trace": [
      {
        "column": 15,
        "file": "node:internal/modules/cjs/loader",
        "function": "Function._resolveFilename",
        "line": 1249,
        "method": "_resolveFilename",
        "native": false
      },
      {
        "column": 27,
        "file": "node:internal/modules/cjs/loader",
        "function": "Function._load",
        "line": 1075,
        "method": "_load",
        "native": false
      },
      {
        "column": 14,
        "file": "node:diagnostics_channel",
        "function": "TracingChannel.traceSync",
        "line": 315,
        "method": "traceSync",
        "native": false
      },
      {
        "column": 24,
        "file": "node:internal/modules/cjs/loader",
        "function": "wrapModuleLoad",
        "line": 218,
        "method": null,
        "native": false
      },
      {
        "column": 12,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module.require",
        "line": 1340,
        "method": "require",
        "native": false
      },
      {
        "column": 16,
        "file": "node:internal/modules/helpers",
        "function": "require",
        "line": 141,
        "method": null,
        "native": false
      },
      {
        "column": 21,
        "file": "/home/devbox/project/server/controllers/user.controller.js",
        "function": null,
        "line": 2,
        "method": null,
        "native": false
      },
      {
        "column": 14,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module._compile",
        "line": 1546,
        "method": "_compile",
        "native": false
      },
      {
        "column": 10,
        "file": "node:internal/modules/cjs/loader",
        "function": "Object..js",
        "line": 1689,
        "method": ".js",
        "native": false
      },
      {
        "column": 32,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module.load",
        "line": 1318,
        "method": "load",
        "native": false
      }
    ],
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:23:01.975] ERROR: uncaughtException: Cannot find module '../models/pointRecord.model'
Require stack:
- /home/devbox/project/server/controllers/user.controller.js
- /home/devbox/project/server/routes/auth.routes.js
- /home/devbox/project/server/app.js
Error: Cannot find module '../models/pointRecord.model'
Require stack:
- /home/devbox/project/server/controllers/user.controller.js
- /home/devbox/project/server/routes/auth.routes.js
- /home/devbox/project/server/app.js
    at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)
    at Function._load (node:internal/modules/cjs/loader:1075:27)
    at TracingChannel.traceSync (node:diagnostics_channel:315:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:218:24)
    at Module.require (node:internal/modules/cjs/loader:1340:12)
    at require (node:internal/modules/helpers:141:16)
    at Object.<anonymous> (/home/devbox/project/server/controllers/user.controller.js:2:21)
    at Module._compile (node:internal/modules/cjs/loader:1546:14)
    at Object..js (node:internal/modules/cjs/loader:1689:10)
    at Module.load (node:internal/modules/cjs/loader:1318:32)
Details: {
  "metadata": {
    "error": {
      "code": "MODULE_NOT_FOUND",
      "requireStack": [
        "/home/devbox/project/server/controllers/user.controller.js",
        "/home/devbox/project/server/routes/auth.routes.js",
        "/home/devbox/project/server/app.js"
      ]
    },
    "stack": "Error: Cannot find module '../models/pointRecord.model'\nRequire stack:\n- /home/devbox/project/server/controllers/user.controller.js\n- /home/devbox/project/server/routes/auth.routes.js\n- /home/devbox/project/server/app.js\n    at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)\n    at Function._load (node:internal/modules/cjs/loader:1075:27)\n    at TracingChannel.traceSync (node:diagnostics_channel:315:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:218:24)\n    at Module.require (node:internal/modules/cjs/loader:1340:12)\n    at require (node:internal/modules/helpers:141:16)\n    at Object.<anonymous> (/home/devbox/project/server/controllers/user.controller.js:2:21)\n    at Module._compile (node:internal/modules/cjs/loader:1546:14)\n    at Object..js (node:internal/modules/cjs/loader:1689:10)\n    at Module.load (node:internal/modules/cjs/loader:1318:32)",
    "exception": true,
    "date": "Sat Jan 04 2025 14:23:01 GMT+0000 (Coordinated Universal Time)",
    "process": {
      "pid": 38553,
      "uid": 1000,
      "gid": 1000,
      "cwd": "/home/devbox/project",
      "execPath": "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
      "version": "v22.11.0",
      "argv": [
        "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
        "/home/devbox/project/server/app.js"
      ],
      "memoryUsage": {
        "rss": 86159360,
        "heapTotal": 34463744,
        "heapUsed": 21475528,
        "external": 20376369,
        "arrayBuffers": 18262288
      }
    },
    "os": {
      "loadavg": [
        1.79,
        1.71,
        1.89
      ],
      "uptime": 3744156.63
    },
    "trace": [
      {
        "column": 15,
        "file": "node:internal/modules/cjs/loader",
        "function": "Function._resolveFilename",
        "line": 1249,
        "method": "_resolveFilename",
        "native": false
      },
      {
        "column": 27,
        "file": "node:internal/modules/cjs/loader",
        "function": "Function._load",
        "line": 1075,
        "method": "_load",
        "native": false
      },
      {
        "column": 14,
        "file": "node:diagnostics_channel",
        "function": "TracingChannel.traceSync",
        "line": 315,
        "method": "traceSync",
        "native": false
      },
      {
        "column": 24,
        "file": "node:internal/modules/cjs/loader",
        "function": "wrapModuleLoad",
        "line": 218,
        "method": null,
        "native": false
      },
      {
        "column": 12,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module.require",
        "line": 1340,
        "method": "require",
        "native": false
      },
      {
        "column": 16,
        "file": "node:internal/modules/helpers",
        "function": "require",
        "line": 141,
        "method": null,
        "native": false
      },
      {
        "column": 21,
        "file": "/home/devbox/project/server/controllers/user.controller.js",
        "function": null,
        "line": 2,
        "method": null,
        "native": false
      },
      {
        "column": 14,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module._compile",
        "line": 1546,
        "method": "_compile",
        "native": false
      },
      {
        "column": 10,
        "file": "node:internal/modules/cjs/loader",
        "function": "Object..js",
        "line": 1689,
        "method": ".js",
        "native": false
      },
      {
        "column": 32,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module.load",
        "line": 1318,
        "method": "load",
        "native": false
      }
    ],
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:25:04.893] INFO: 数据库连接成功
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:25:04.896] INFO: MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:25:04.899] INFO: 服务器已启动，监听端口 3000
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:25:04.900] INFO: 环境: production
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:25:04.900] INFO: API版本: 1.0.0
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:25:17.016] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 14:25:17.020] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 14:25:25.963] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:25:25.966] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:25:26.080] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:25:26.082] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:25:28.265] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 14:25:28.268] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 14:27:24.667] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 14:27:24.670] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 14:27:32.041] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 14:27:32.045] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 14:27:32.115] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 14:27:32.118] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 14:27:32.871] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 14:27:32.874] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 14:27:52.443] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 14:27:52.445] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 14:29:06.271] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 14:29:06.275] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 14:30:44.311] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 14:30:44.313] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 14:30:50.722] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:30:50.724] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:30:50.836] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:30:50.838] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:30:53.022] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 14:30:53.024] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 14:31:41.915] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 14:31:41.918] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 14:31:41.951] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 14:31:41.953] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 14:31:42.904] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 14:31:42.906] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 14:35:09.145] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 14:35:09.149] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 14:35:12.267] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:35:12.269] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:35:12.331] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:35:12.332] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:35:14.862] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 14:35:14.864] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 14:35:18.031] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:35:18.033] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:35:18.095] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:35:18.097] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:35:27.010] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:35:27.012] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:38:07.992] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:38:07.995] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:38:08.061] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:38:08.062] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:38:17.314] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:38:17.315] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:38:17.377] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:38:17.379] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:38:40.138] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:38:40.140] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:38:40.206] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:38:40.208] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:39:57.828] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:39:57.830] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:39:57.895] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:39:57.897] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:40:01.473] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 14:40:01.476] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 14:40:01.547] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 14:40:01.550] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 14:40:04.371] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:40:04.373] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:40:04.439] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:40:04.440] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:40:16.668] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:40:16.669] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:40:16.731] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:40:16.733] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:42:52.783] ERROR: Expected property name or '}' in JSON at position 1 (line 1 column 2)
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "stack": "SyntaxError: Expected property name or '}' in JSON at position 1 (line 1 column 2)\n    at JSON.parse (<anonymous>)\n    at parse (/home/devbox/project/node_modules/body-parser/lib/types/json.js:92:19)\n    at /home/devbox/project/node_modules/body-parser/lib/read.js:128:18\n    at AsyncResource.runInAsyncScope (node:async_hooks:211:14)\n    at invokeCallback (/home/devbox/project/node_modules/raw-body/index.js:238:16)\n    at done (/home/devbox/project/node_modules/raw-body/index.js:227:7)\n    at IncomingMessage.onEnd (/home/devbox/project/node_modules/raw-body/index.js:287:7)\n    at IncomingMessage.emit (node:events:518:28)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)",
    "path": "/api/auth/login",
    "method": "POST",
    "body": {},
    "user": "anonymous"
  }
}
[2025-01-04 14:42:52.792] WARN: 认证失败: 未提供token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:43:48.898] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:43:48.900] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 14:43:48.968] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 14:43:48.970] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 15:36:14.212] INFO: 数据库连接成功
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:36:14.215] INFO: MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:36:14.219] INFO: 服务器已启动，监听端口 3000
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:36:14.219] INFO: 环境: development
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:36:14.220] INFO: API版本: 1.0.0
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:36:26.153] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 15:36:26.163] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-04 15:36:28.906] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-04 15:36:29.009] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-04 15:36:29.734] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 15:36:29.738] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 15:36:29.772] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 15:36:29.775] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 15:36:30.683] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 15:36:30.686] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 15:36:33.744] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 15:36:33.748] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 15:36:33.749] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 15:36:33.751] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 15:36:33.790] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:36:33.790] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 15:36:33.790] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 15:36:33.791] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 15:36:33.792] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:36:33.792] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:36:33.792] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "最近单量差",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "最近单量差"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:36:34.033] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501042336335BFC4A89AFDCD3E854B4"
      }
    }
  }
}
[2025-01-04 15:36:34.034] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:36:34.034] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:36:34.035] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:36:34.035] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 15:36:36.036] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 15:36:36.037] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 15:36:36.037] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:36:36.037] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:36:36.037] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "最近单量差",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "最近单量差"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:36:36.124] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501042336365B1E33F439CBADFABD42"
      }
    }
  }
}
[2025-01-04 15:36:36.125] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:36:36.125] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:36:36.126] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:36:36.126] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 15:36:40.127] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 15:36:40.128] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 15:36:40.128] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:36:40.128] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:36:40.129] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "最近单量差",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "最近单量差"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:36:40.213] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250104233640742AC95702901CE9D7CF"
      }
    }
  }
}
[2025-01-04 15:36:40.213] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:36:40.213] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:36:40.214] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:36:40.214] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:36:40.214] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 15:36:40.214] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 15:36:40.215] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 15:37:10.874] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 15:37:10.878] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 15:37:13.745] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 15:37:13.748] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/---------a187a314/chat"
  }
}
[2025-01-04 15:37:13.748] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "---------a187a314"
  }
}
[2025-01-04 15:37:13.750] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778e3cd61261a424ab4644e",
    "key": "---------a187a314",
    "name": "美团品牌定位设计"
  }
}
[2025-01-04 15:37:13.752] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:37:13.752] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 15:37:13.753] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 15:37:13.753] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595"
    }
  }
}
[2025-01-04 15:37:13.753] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:37:13.753] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:37:13.754] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7432139594210115595",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7432139594210115595",
      "messages": [
        {
          "role": "user",
          "content": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:37:13.904] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250104233713752EC1675FA5F1172025"
      }
    }
  }
}
[2025-01-04 15:37:13.904] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:37:13.905] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:37:13.905] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:37:13.905] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 15:37:15.907] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 15:37:15.908] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595"
    }
  }
}
[2025-01-04 15:37:15.908] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:37:15.908] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:37:15.908] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7432139594210115595",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7432139594210115595",
      "messages": [
        {
          "role": "user",
          "content": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:37:15.991] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501042337154FDC3FD106A387CB1206"
      }
    }
  }
}
[2025-01-04 15:37:15.991] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:37:15.992] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:37:15.992] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:37:15.992] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 15:37:19.993] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 15:37:19.994] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595"
    }
  }
}
[2025-01-04 15:37:19.994] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:37:19.994] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:37:19.995] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7432139594210115595",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7432139594210115595",
      "messages": [
        {
          "role": "user",
          "content": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:37:20.085] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501042337205ECE9FD760A346FA33AD"
      }
    }
  }
}
[2025-01-04 15:37:20.085] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:37:20.085] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:37:20.086] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:37:20.086] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:37:20.086] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 15:37:20.086] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778e3cd61261a424ab4644e",
    "modelType": "coze"
  }
}
[2025-01-04 15:37:20.087] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778e3cd61261a424ab4644e"
  }
}
[2025-01-04 15:37:26.738] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 15:37:26.743] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-04 15:37:51.671] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 15:37:51.738] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 15:37:53.762] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 15:37:53.764] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 15:37:53.765] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 15:37:53.766] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 15:37:53.768] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:37:53.768] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 15:37:53.769] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 15:37:53.769] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 15:37:53.769] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:37:53.769] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:37:53.769] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "最近单量差",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "最近单量差"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:37:53.880] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250104233753CFC2BB7023BF63C7EBCC"
      }
    }
  }
}
[2025-01-04 15:37:53.881] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:37:53.881] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:37:53.881] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:37:53.882] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 15:37:55.883] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 15:37:55.883] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 15:37:55.883] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:37:55.884] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:37:55.884] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "最近单量差",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "最近单量差"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:37:55.969] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250104233755FD7DCF838F2505E98B8E"
      }
    }
  }
}
[2025-01-04 15:37:55.970] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:37:55.970] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:37:55.970] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:37:55.971] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 15:37:59.971] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 15:37:59.972] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 15:37:59.972] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:37:59.972] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:37:59.973] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "最近单量差",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "最近单量差"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:38:00.067] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010423375938358EFBA9B09CE7972E"
      }
    }
  }
}
[2025-01-04 15:38:00.068] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:38:00.068] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:38:00.069] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:38:00.069] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:38:00.069] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 15:38:00.069] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 15:38:00.070] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 15:46:48.342] INFO: 数据库连接成功
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:46:48.345] INFO: MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:46:48.349] INFO: 服务器已启动，监听端口 3000
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:46:48.349] INFO: 环境: development
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:46:48.350] INFO: API版本: 1.0.0
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:47:11.164] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-04 15:47:11.276] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-04 15:47:11.926] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 15:47:11.931] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 15:47:12.008] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 15:47:12.011] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 15:47:13.170] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 15:47:13.174] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 15:47:18.594] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 15:47:18.597] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 15:47:18.598] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 15:47:18.600] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 15:47:18.637] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 15:47:18.638] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 15:47:18.638] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 15:47:18.639] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 15:47:18.640] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:47:18.640] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:47:18.641] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "11111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "11111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:47:18.853] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501042347181EC27A964184EFE65BC3"
      }
    }
  }
}
[2025-01-04 15:47:18.854] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:47:18.855] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:47:18.855] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:47:18.855] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 15:47:20.857] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 15:47:20.858] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 15:47:20.858] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:47:20.859] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:47:20.859] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "11111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "11111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:47:20.946] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250104234720E9955DB95C5086D367F1"
      }
    }
  }
}
[2025-01-04 15:47:20.946] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:47:20.947] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:47:20.947] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:47:20.947] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 15:47:24.949] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 15:47:24.950] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 15:47:24.950] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 15:47:24.950] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 15:47:24.951] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "11111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "11111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 15:47:25.044] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250104234724D6AB5BBC707A04CEBD2A"
      }
    }
  }
}
[2025-01-04 15:47:25.045] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:47:25.045] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:47:25.046] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:47:25.046] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:47:25.047] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 15:47:25.047] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 15:47:25.047] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 15:51:01.569] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 15:51:01.574] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 15:52:23.636] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 15:52:23.640] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 15:53:02.064] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 15:53:02.067] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-04 15:53:02.137] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 15:53:02.140] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-04 16:03:27.127] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-04 16:03:27.226] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-04 16:03:38.868] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:03:38.870] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:03:38.870] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:03:38.872] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:03:38.874] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:03:38.874] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:03:38.875] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:03:38.875] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:03:38.875] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:03:38.875] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:03:38.876] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:03:39.075] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105000338BD84170D3A3C050C6A87"
      }
    }
  }
}
[2025-01-04 16:03:39.076] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:03:39.076] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:03:39.076] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:03:39.077] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:03:41.079] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:03:41.079] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:03:41.080] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:03:41.080] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:03:41.080] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:03:41.166] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050003418745F91CEB1DFDFADD9D"
      }
    }
  }
}
[2025-01-04 16:03:41.166] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:03:41.167] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:03:41.167] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:03:41.168] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:03:45.169] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:03:45.169] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:03:45.170] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:03:45.170] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:03:45.170] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:03:45.268] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105000345A8C15AB197A8A3C18F57"
      }
    }
  }
}
[2025-01-04 16:03:45.268] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:03:45.268] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:03:45.269] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:03:45.269] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:03:45.269] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:03:45.270] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:03:45.270] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 16:15:25.012] INFO: 数据库连接成功
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:15:25.015] INFO: MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:15:25.019] INFO: 服务器已启动，监听端口 3000
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:15:25.020] INFO: 环境: development
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:15:25.020] INFO: API版本: 1.0.0
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:15:43.273] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:15:43.284] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-04 16:15:43.322] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:15:43.324] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-04 16:15:48.186] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-04 16:15:48.288] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-04 16:15:48.983] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:15:48.988] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:15:49.056] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:15:49.059] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:15:50.195] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:15:50.198] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:15:53.069] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:15:53.072] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:15:53.073] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:15:53.075] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:15:53.112] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:15:53.112] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:15:53.112] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:15:53.113] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:15:53.114] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:15:53.115] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:15:53.115] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:15:53.449] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105001553FCC40B50FABAFEC73EF3"
      }
    }
  }
}
[2025-01-04 16:15:53.449] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:15:53.450] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:15:53.450] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:15:53.451] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:15:55.452] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:15:55.452] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:15:55.453] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:15:55.453] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:15:55.453] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:15:55.532] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050015551677147808634E0021C4"
      }
    }
  }
}
[2025-01-04 16:15:55.532] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:15:55.533] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:15:55.533] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:15:55.533] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:15:59.535] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:15:59.536] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:15:59.536] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:15:59.536] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:15:59.536] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:15:59.620] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105001559840FEAA6CA3C4BFFA2B3"
      }
    }
  }
}
[2025-01-04 16:15:59.621] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:15:59.621] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:15:59.622] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:15:59.622] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:15:59.622] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:15:59.622] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:15:59.623] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 16:16:03.139] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:03.142] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:03.142] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:16:03.145] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:16:03.221] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:03.223] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:03.224] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:03.279] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:03.282] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:03.282] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:16:03.284] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:16:03.425] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:03.428] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:03.428] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:05.354] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:05.356] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-04 16:16:05.357] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-04 16:16:05.394] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:05.397] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-04 16:16:05.397] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-04 16:16:06.370] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:16:06.373] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:16:06.406] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:16:06.409] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:16:07.985] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:07.988] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:07.990] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:07.990] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:16:07.991] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:07.991] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:07.993] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:16:08.026] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:08.028] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:08.029] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:08.030] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:08.031] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:08.031] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:16:08.033] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:16:08.738] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:16:08.741] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:16:08.774] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:16:08.776] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:16:12.415] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:12.417] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:12.419] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:12.420] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:16:12.421] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:12.421] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:12.422] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:16:12.497] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:12.499] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:12.501] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:12.501] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:16:12.503] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:12.503] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:16:12.504] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 13,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:16:13.753] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:16:13.756] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:16:13.790] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:16:13.792] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:16:26.528] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "config": {
      "modelType": "coze",
      "apiKey": "***",
      "temperature": 0.8,
      "maxTokens": 2000,
      "model": "coze-bot",
      "botId": "7450790638439907355",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat"
    }
  }
}
[2025-01-04 16:16:26.531] INFO: 接收到的配置数据:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "originalBotId": "7450790638439907355",
    "existingBotId": "7450790638439907355",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-04 16:16:26.531] INFO: 配置更新详情:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "modelType": "coze",
    "model": "coze-bot",
    "hasBotId": true,
    "hasApiKey": true,
    "hasApiUrl": true,
    "botIdType": "string",
    "apiKeyType": "string",
    "apiUrlType": "string",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-04 16:16:26.531] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "botId",
      "apiUrl",
      "temperature",
      "maxTokens",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:16:26.532] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:16:26.543] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:16:26.543] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:16:26.544] INFO: AI助手更新成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "modelType": "coze",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:16:26.645] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:16:26.648] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:16:26.699] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:16:26.702] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:16:44.396] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:16:44.399] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:16:44.468] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:16:44.471] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:16:45.044] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:16:45.047] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:16:48.429] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:16:48.432] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:16:48.432] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:16:48.434] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:16:48.436] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:16:48.437] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:16:48.437] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:16:48.437] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:16:48.438] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:16:48.438] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:16:48.438] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:16:48.787] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105001648EF6406EAC5FAB3FA3037"
      }
    }
  }
}
[2025-01-04 16:16:48.787] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:16:48.788] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:16:48.788] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:16:48.788] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:16:50.790] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:16:50.790] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:16:50.790] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:16:50.791] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:16:50.791] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:16:50.881] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050016505E744B1F4239F709D48B"
      }
    }
  }
}
[2025-01-04 16:16:50.882] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:16:50.882] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:16:50.882] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:16:50.883] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:16:54.883] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:16:54.884] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:16:54.884] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:16:54.884] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:16:54.885] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:16:54.980] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105001654CD85540728B1E3DD3BE4"
      }
    }
  }
}
[2025-01-04 16:16:54.981] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:16:54.981] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:16:54.981] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:16:54.981] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:16:54.982] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:16:54.982] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:16:54.982] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 16:17:25.336] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:17:25.340] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:17:28.327] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:17:28.329] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/---------a187a314/chat"
  }
}
[2025-01-04 16:17:28.330] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "---------a187a314"
  }
}
[2025-01-04 16:17:28.332] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778e3cd61261a424ab4644e",
    "key": "---------a187a314",
    "name": "美团品牌定位设计"
  }
}
[2025-01-04 16:17:28.333] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:17:28.333] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:17:28.334] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:17:28.334] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595"
    }
  }
}
[2025-01-04 16:17:28.334] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:17:28.334] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:17:28.334] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7432139594210115595",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7432139594210115595",
      "messages": [
        {
          "role": "user",
          "content": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:17:28.506] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105001728162151D221F8AC04B87B"
      }
    }
  }
}
[2025-01-04 16:17:28.506] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:17:28.507] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:17:28.507] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:17:28.507] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:17:30.510] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:17:30.510] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595"
    }
  }
}
[2025-01-04 16:17:30.511] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:17:30.511] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:17:30.511] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7432139594210115595",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7432139594210115595",
      "messages": [
        {
          "role": "user",
          "content": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:17:30.622] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010500173042BA730E127E3BFF401D"
      }
    }
  }
}
[2025-01-04 16:17:30.622] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:17:30.623] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:17:30.623] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:17:30.623] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:17:34.625] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:17:34.626] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595"
    }
  }
}
[2025-01-04 16:17:34.626] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:17:34.626] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:17:34.627] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7432139594210115595",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7432139594210115595",
      "messages": [
        {
          "role": "user",
          "content": "🗃️店铺名称\t琦超家砂锅酥肉面\t\t\t\t\n🗃️经营品类\t主营：美食 > 快餐简餐 > 砂锅\t\t\t\t"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:17:34.707] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050017349D83C9F4184AEA15776A"
      }
    }
  }
}
[2025-01-04 16:17:34.707] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:17:34.708] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7432139594210115595",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:17:34.708] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:17:34.708] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:17:34.709] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:17:34.709] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778e3cd61261a424ab4644e",
    "modelType": "coze"
  }
}
[2025-01-04 16:17:34.709] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778e3cd61261a424ab4644e"
  }
}
[2025-01-04 16:17:43.337] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:17:43.342] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:17:49.943] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:17:49.945] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-04 16:17:50.020] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:17:50.023] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-04 16:17:50.201] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:17:50.203] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:17:50.237] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:17:50.240] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:17:52.622] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:17:52.624] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:18:11.485] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:18:11.488] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-04 16:18:11.606] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:18:11.609] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-04 16:18:11.609] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:18:11.613] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-04 16:20:11.685] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:20:11.688] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-04 16:20:11.765] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:20:11.767] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-04 16:20:12.066] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:20:12.068] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:20:12.140] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:20:12.143] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:20:13.534] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:20:13.537] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:20:18.241] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:20:18.243] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:20:18.244] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:20:18.246] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:20:18.247] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:20:18.248] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:20:18.248] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:20:18.248] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:20:18.248] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:20:18.248] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:20:18.249] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:20:18.428] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010500201810DB0B880660F3051E65"
      }
    }
  }
}
[2025-01-04 16:20:18.428] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:20:18.428] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:20:18.429] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:20:18.429] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:20:20.430] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:20:20.430] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:20:20.430] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:20:20.431] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:20:20.431] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:20:20.596] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050020204FB916BC85AA6CC6AACD"
      }
    }
  }
}
[2025-01-04 16:20:20.596] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:20:20.597] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:20:20.597] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:20:20.597] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:20:24.599] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:20:24.600] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:20:24.600] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:20:24.600] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:20:24.600] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:20:24.766] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010500202432D87EAB7EBA07CDDA21"
      }
    }
  }
}
[2025-01-04 16:20:24.766] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:20:24.767] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:20:24.767] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:20:24.767] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:20:24.767] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:20:24.768] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:20:24.768] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 16:27:02.832] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:27:02.835] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:27:02.835] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:27:02.837] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 14,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:27:02.864] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:27:02.867] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:27:02.867] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:27:02.896] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:27:02.899] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:27:02.899] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:27:02.901] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 14,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:27:02.928] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:27:02.930] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:27:02.931] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:27:04.737] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:27:04.740] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:27:04.811] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:27:04.814] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:27:09.537] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "config": {
      "modelType": "coze",
      "apiKey": "***",
      "temperature": 0.8,
      "maxTokens": 2000,
      "model": "coze-bot",
      "botId": "7450790638439907355",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat"
    }
  }
}
[2025-01-04 16:27:09.539] INFO: 接收到的配置数据:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "originalBotId": "7450790638439907355",
    "existingBotId": "7450790638439907355",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-04 16:27:09.539] INFO: 配置更新详情:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "modelType": "coze",
    "model": "coze-bot",
    "hasBotId": true,
    "hasApiKey": true,
    "hasApiUrl": true,
    "botIdType": "string",
    "apiKeyType": "string",
    "apiUrlType": "string",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-04 16:27:09.540] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "botId",
      "apiUrl",
      "temperature",
      "maxTokens",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:27:09.540] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:27:09.544] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:27:09.544] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:27:09.545] INFO: AI助手更新成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "modelType": "coze",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:27:09.621] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:27:09.624] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:27:09.680] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:27:09.683] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:29:36.091] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:29:36.094] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:29:36.168] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:29:36.171] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:29:36.984] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:29:36.986] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:29:41.595] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:29:41.597] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:29:41.598] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:29:41.599] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:29:41.601] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:29:41.601] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:29:41.601] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:29:41.602] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:29:41.602] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:29:41.602] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:29:41.602] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "11111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "11111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:29:41.763] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105002941D4D43965870C35FB792C"
      }
    }
  }
}
[2025-01-04 16:29:41.763] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:29:41.764] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:29:41.764] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:29:41.764] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:29:43.767] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:29:43.768] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:29:43.768] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:29:43.768] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:29:43.768] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "11111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "11111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:29:43.854] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010500294397DEFA38EDDB9ECCCED1"
      }
    }
  }
}
[2025-01-04 16:29:43.855] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:29:43.855] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:29:43.856] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:29:43.856] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:29:47.858] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:29:47.858] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:29:47.859] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:29:47.859] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:29:47.859] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "11111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "11111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:29:47.941] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050029472791727AC84D2AE32E8F"
      }
    }
  }
}
[2025-01-04 16:29:47.941] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:29:47.942] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:29:47.942] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:29:47.942] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:29:47.942] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:29:47.943] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:29:47.943] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 16:31:53.931] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:31:53.933] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:31:53.933] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:31:53.935] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:31:53.937] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:31:53.937] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:31:53.937] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:31:53.937] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:31:53.938] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:31:53.938] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:31:53.938] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "123",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "123"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:31:54.116] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105003154DE852E45EF2CA01165B5"
      }
    }
  }
}
[2025-01-04 16:31:54.116] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:31:54.116] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:31:54.117] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:31:54.117] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:31:56.117] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:31:56.118] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:31:56.119] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:31:56.120] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:31:56.121] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "123",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "123"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:31:56.204] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105003156DE1EAFD7CD9D1207A990"
      }
    }
  }
}
[2025-01-04 16:31:56.205] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:31:56.205] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:31:56.205] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:31:56.206] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:32:00.207] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:32:00.207] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:32:00.208] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:32:00.208] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:32:00.208] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "123",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "123"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:32:00.298] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050032004D5115E41340B702EFC7"
      }
    }
  }
}
[2025-01-04 16:32:00.298] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:32:00.299] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:32:00.299] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:32:00.299] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:32:00.300] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:32:00.300] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:32:00.300] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 16:32:08.029] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:32:08.031] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:32:08.032] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:32:08.035] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 14,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:32:08.060] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:32:08.063] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:32:08.063] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:32:08.093] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:32:08.094] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:32:08.095] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:32:08.097] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 14,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:32:08.124] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:32:08.126] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:32:08.127] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:32:09.151] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:32:09.157] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:32:09.224] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:32:09.226] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:32:20.031] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "config": {
      "modelType": "coze",
      "apiKey": "***",
      "temperature": 0.8,
      "maxTokens": 2000,
      "model": "coze-bot",
      "botId": "7450790638439907355",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat"
    }
  }
}
[2025-01-04 16:32:20.033] INFO: 接收到的配置数据:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "originalBotId": "7450790638439907355",
    "existingBotId": "7450790638439907355",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-04 16:32:20.033] INFO: 配置更新详情:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "modelType": "coze",
    "model": "coze-bot",
    "hasBotId": true,
    "hasApiKey": true,
    "hasApiUrl": true,
    "botIdType": "string",
    "apiKeyType": "string",
    "apiUrlType": "string",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-04 16:32:20.034] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "botId",
      "apiUrl",
      "temperature",
      "maxTokens",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:32:20.034] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:32:20.038] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:32:20.038] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:32:20.038] INFO: AI助手更新成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "modelType": "coze",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:32:20.140] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:32:20.142] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:32:20.183] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:32:20.186] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:35:05.546] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:35:05.548] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:35:05.549] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:35:05.550] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:35:05.551] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:35:05.551] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:35:05.553] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 15,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:35:05.584] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:35:05.587] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:35:05.587] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:35:05.617] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:35:05.620] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:35:05.620] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:35:05.622] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 15,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:35:07.669] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:35:07.671] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:35:07.744] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:35:07.747] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:35:56.550] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:35:56.553] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:35:56.627] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:35:56.630] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:35:57.523] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:35:57.527] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:36:03.343] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:36:03.346] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:36:03.346] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:36:03.348] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:36:03.349] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:36:03.350] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:36:03.350] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:36:03.350] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:36:03.350] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:36:03.350] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:36:03.350] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "1111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "1111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:36:03.496] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050036036DB9707CF4F10A0CE91F"
      }
    }
  }
}
[2025-01-04 16:36:03.496] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:36:03.497] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:36:03.497] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:36:03.497] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:36:05.499] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:36:05.500] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:36:05.500] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:36:05.500] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:36:05.500] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "1111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "1111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:36:05.591] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010500360510A7B50A56E786FBA702"
      }
    }
  }
}
[2025-01-04 16:36:05.591] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:36:05.592] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:36:05.592] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:36:05.592] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:36:09.593] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:36:09.594] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:36:09.594] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:36:09.594] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:36:09.595] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "1111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "1111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:36:09.753] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105003609CB38F6C3D3D266C65513"
      }
    }
  }
}
[2025-01-04 16:36:09.754] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:36:09.754] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:36:09.755] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:36:09.755] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:36:09.755] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:36:09.756] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:36:09.756] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 16:42:11.300] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:42:11.302] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:42:11.303] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:42:11.305] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:42:11.306] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:42:11.307] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:42:11.307] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:42:11.307] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:42:11.308] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:42:11.308] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:42:11.308] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:42:11.563] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010500421117C1AB301158C8C36765"
      }
    }
  }
}
[2025-01-04 16:42:11.563] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:42:11.564] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:42:11.564] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:42:11.564] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:42:13.566] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:42:13.567] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:42:13.567] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:42:13.567] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:42:13.567] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:42:13.749] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105004213B2C3A541DEE897052FCA"
      }
    }
  }
}
[2025-01-04 16:42:13.749] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:42:13.750] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:42:13.750] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:42:13.750] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:42:17.751] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:42:17.752] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:42:17.752] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:42:17.752] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:42:17.752] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:42:17.836] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105004217B0576847B9F9DFEC058B"
      }
    }
  }
}
[2025-01-04 16:42:17.837] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:42:17.837] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:42:17.838] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:42:17.838] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:42:17.838] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:42:17.838] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:42:17.838] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 16:44:47.064] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:44:47.067] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:44:47.067] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:44:47.069] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:44:47.070] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:44:47.070] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:44:47.071] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:44:47.071] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:44:47.071] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:44:47.071] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:44:47.071] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:44:47.228] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050044479C0D8115672E69F590B7"
      }
    }
  }
}
[2025-01-04 16:44:47.229] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:44:47.229] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:44:47.229] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:44:47.230] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:44:49.232] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:44:49.232] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:44:49.232] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:44:49.232] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:44:49.233] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:44:49.320] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050044495187EEA18EA5CC041053"
      }
    }
  }
}
[2025-01-04 16:44:49.321] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:44:49.321] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:44:49.322] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:44:49.322] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:44:53.322] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:44:53.322] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:44:53.323] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:44:53.323] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:44:53.323] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:44:53.417] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105004453B560C0C6D31C9FDFF041"
      }
    }
  }
}
[2025-01-04 16:44:53.417] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:44:53.418] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:44:53.418] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:44:53.418] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:44:53.419] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:44:53.419] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:44:53.419] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 16:44:59.210] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-04 16:44:59.312] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-04 16:44:59.954] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:44:59.957] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:44:59.989] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:44:59.992] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:45:01.042] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:45:01.044] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:45:03.357] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:45:03.359] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:45:03.360] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:45:03.362] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:45:03.363] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:45:03.364] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:45:03.364] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:45:03.364] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:45:03.364] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:45:03.365] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:45:03.365] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111111111111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111111111111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:45:03.531] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105004503D7C5FE643F5B511235C5"
      }
    }
  }
}
[2025-01-04 16:45:03.531] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:45:03.531] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:45:03.532] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:45:03.532] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:45:05.533] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:45:05.533] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:45:05.533] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:45:05.534] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:45:05.534] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111111111111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111111111111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:45:05.620] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105004505546B249D9DE9DEFAD4DB"
      }
    }
  }
}
[2025-01-04 16:45:05.620] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:45:05.621] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:45:05.621] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:45:05.621] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:45:09.623] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:45:09.624] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:45:09.624] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:45:09.624] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:45:09.624] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111111111111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111111111111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:45:09.714] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010500450981EEDBA32BCFACD43193"
      }
    }
  }
}
[2025-01-04 16:45:09.715] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:45:09.715] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:45:09.716] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:45:09.716] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:45:09.716] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:45:09.716] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:45:09.716] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 16:45:35.464] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:45:35.467] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:45:35.467] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:45:35.469] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 15,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:45:35.494] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:45:35.497] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:45:35.497] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:45:35.526] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:45:35.528] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:45:35.528] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:45:35.530] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 15,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-04 16:45:35.558] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:45:35.561] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:45:35.561] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-04 16:45:37.197] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:45:37.200] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:45:37.232] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:45:37.234] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:45:46.849] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "config": {
      "modelType": "coze",
      "apiKey": "***",
      "temperature": 0.8,
      "maxTokens": 2000,
      "model": "coze-bot",
      "botId": "7450790638439907355",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat"
    }
  }
}
[2025-01-04 16:45:46.851] INFO: 接收到的配置数据:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "originalBotId": "7450790638439907355",
    "existingBotId": "7450790638439907355",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-04 16:45:46.852] INFO: 配置更新详情:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "modelType": "coze",
    "model": "coze-bot",
    "hasBotId": true,
    "hasApiKey": true,
    "hasApiUrl": true,
    "botIdType": "string",
    "apiKeyType": "string",
    "apiUrlType": "string",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-04 16:45:46.852] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "botId",
      "apiUrl",
      "temperature",
      "maxTokens",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:45:46.853] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:45:46.858] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:45:46.858] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:45:46.859] INFO: AI助手更新成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "modelType": "coze",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:45:46.956] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:45:46.960] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:45:47.007] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:45:47.010] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:48:07.982] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:48:07.984] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:48:08.056] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:48:08.058] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:48:08.798] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:48:08.802] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:48:10.623] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:48:10.626] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:48:10.627] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:48:10.628] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:48:10.630] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:48:10.630] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:48:10.631] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:48:10.631] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:48:10.631] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:48:10.631] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:48:10.632] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:48:10.846] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105004810624E1A40C16888F1DA8E"
      }
    }
  }
}
[2025-01-04 16:48:10.846] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:48:10.846] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:48:10.847] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:48:10.847] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:48:12.847] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:48:12.848] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:48:12.848] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:48:12.849] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:48:12.849] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:48:12.937] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105004812B97DAE7D11C38DFAA25D"
      }
    }
  }
}
[2025-01-04 16:48:12.937] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:48:12.938] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:48:12.938] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:48:12.938] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:48:16.938] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:48:16.939] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:48:16.939] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:48:16.939] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:48:16.939] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:48:17.024] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105004816F0DA6A2F6806792EB377"
      }
    }
  }
}
[2025-01-04 16:48:17.024] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:48:17.025] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:48:17.025] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:48:17.025] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:48:17.025] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:48:17.025] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:48:17.026] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-04 16:50:34.007] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-04 16:50:34.095] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-04 16:50:34.729] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:50:34.731] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:50:34.764] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:50:34.766] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:50:35.477] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-04 16:50:35.480] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-04 16:50:37.627] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-04 16:50:37.629] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-04 16:50:37.629] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-04 16:50:37.631] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-04 16:50:37.632] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-04 16:50:37.633] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-04 16:50:37.633] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-04 16:50:37.633] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:50:37.633] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:50:37.633] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:50:37.634] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:50:37.821] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105005037ECABB2F877191EC260FB"
      }
    }
  }
}
[2025-01-04 16:50:37.822] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:50:37.822] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:50:37.822] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:50:37.823] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-04 16:50:39.824] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-04 16:50:39.824] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:50:39.825] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:50:39.825] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:50:39.825] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:50:39.911] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105005039C6D89A4143BE31F91246"
      }
    }
  }
}
[2025-01-04 16:50:39.912] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:50:39.912] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:50:39.913] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:50:39.913] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-04 16:50:43.915] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-04 16:50:43.916] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-04 16:50:43.916] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-04 16:50:43.916] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-04 16:50:43.916] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-04 16:50:44.003] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010500504325C7D9E6B60EF905F430"
      }
    }
  }
}
[2025-01-04 16:50:44.003] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:50:44.003] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:50:44.004] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:50:44.004] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:50:44.004] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:50:44.004] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-04 16:50:44.005] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 00:45:44.169] INFO: 数据库连接成功
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 00:45:44.172] INFO: MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 00:45:44.176] INFO: 服务器已启动，监听端口 3000
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 00:45:44.177] INFO: 环境: development
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 00:45:44.177] INFO: API版本: 1.0.0
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 00:46:07.942] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:46:08.139] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 00:46:08.239] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:46:08.242] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 00:49:18.190] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 00:49:18.292] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 00:49:19.083] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:49:19.088] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:49:19.142] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:49:19.145] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:49:21.699] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:21.701] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 00:49:21.859] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:21.862] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 00:49:21.862] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:21.866] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 00:49:26.139] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:26.143] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:49:26.143] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 00:49:26.147] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:26.148] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 15,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-05 00:49:26.150] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:49:26.151] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:49:26.337] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:26.340] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:26.342] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:49:26.343] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 00:49:26.344] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:49:26.344] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:49:26.346] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 15,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-05 00:49:26.986] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:49:26.989] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:49:27.037] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:49:27.040] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:49:28.737] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:28.740] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 00:49:28.740] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 00:49:28.805] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:28.836] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 00:49:28.837] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 00:49:30.769] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:30.772] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 00:49:30.772] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:30.837] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 00:49:36.954] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:49:36.957] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:49:36.990] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:49:36.993] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:49:43.525] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:49:43.528] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:49:43.560] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:49:43.562] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:49:44.449] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:49:44.451] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:49:47.468] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:49:47.470] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 00:49:47.471] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 00:49:47.473] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 00:49:47.513] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 00:49:47.513] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 00:49:47.514] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 00:49:47.514] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 00:49:47.515] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 00:49:47.515] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 00:49:47.515] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "123",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "123"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 00:49:47.774] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050849475287897FD2445013F78C"
      }
    }
  }
}
[2025-01-05 00:49:47.775] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 00:49:47.775] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 00:49:47.776] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 00:49:47.776] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 00:49:49.777] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 00:49:49.778] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 00:49:49.778] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 00:49:49.778] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 00:49:49.778] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "123",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "123"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 00:49:50.001] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105084949396B4B5C8E468EFD0A74"
      }
    }
  }
}
[2025-01-05 00:49:50.001] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 00:49:50.002] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 00:49:50.003] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 00:49:50.003] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 00:49:54.003] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 00:49:54.004] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 00:49:54.004] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 00:49:54.005] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 00:49:54.005] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "123",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "123"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 00:49:54.095] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050849547A08CE640FAAE0212EA2"
      }
    }
  }
}
[2025-01-05 00:49:54.096] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 00:49:54.096] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 00:49:54.097] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 00:49:54.097] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 00:49:54.098] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 00:49:54.098] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 00:49:54.098] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 00:50:13.843] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:50:13.846] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:50:13.847] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:50:13.874] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:50:13.876] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:50:13.876] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 00:50:13.879] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 15,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-05 00:50:13.906] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:50:13.909] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:50:13.909] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:50:13.937] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:50:13.940] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 00:50:13.940] INFO: 开始获取AI助手统计信息
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 00:50:13.942] INFO: 获取AI助手统计信息成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "total": 2,
    "active": 0,
    "inactive": 0,
    "totalPoints": 15,
    "typeStats": {
      "$concat": [
        "{\"",
        "$$this.type",
        "\": ",
        {
          "$toString": "$$this.count"
        },
        "}"
      ]
    }
  }
}
[2025-01-05 00:50:15.467] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:50:15.471] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:50:15.504] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:50:15.507] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:50:30.266] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:50:30.269] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 00:50:30.303] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 00:50:30.306] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 00:50:33.257] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 00:50:33.348] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 00:50:34.153] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:50:34.156] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:50:34.189] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 00:50:34.192] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 00:59:03.992] INFO: 开始创建AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "name": "美团分类栏描述",
    "type": "general"
  }
}
[2025-01-05 00:59:03.993] ERROR: 创建AI助手失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "crypto.randomBytes is not a function",
    "name": "美团分类栏描述",
    "type": "general"
  }
}
[2025-01-05 00:59:03.994] ERROR: 创建AI助手失败: crypto.randomBytes is not a function
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "stack": "ApiError: 创建AI助手失败: crypto.randomBytes is not a function\n    at AiAssistantService.createAssistant (/home/devbox/project/server/services/aiAssistant.service.js:54:19)\n    at exports.createAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:37:52)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.adminAuth (/home/devbox/project/server/middleware/adminAuth.js:13:9)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.auth (/home/devbox/project/server/middleware/auth.js:27:9)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "path": "/api/assistants",
    "method": "POST",
    "body": {
      "name": "美团分类栏描述",
      "description": "美食分类助手，优化描述配表情,提升用户体验",
      "type": "general",
      "pointsCost": 10,
      "isActive": true,
      "config": {
        "modelType": "coze",
        "apiKey": "pat_gMDZEOZoPKPPcr57dT2lNUGCFjqlkYo67GCcDtFTdYkrW92iXVlcLzVAeXgei92l",
        "temperature": 0.7,
        "maxTokens": 2000,
        "model": "coze-bot",
        "botId": "7444769224897085503",
        "apiUrl": "https://api.coze.cn/open_api/v2/chat"
      }
    },
    "user": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:02:14.618] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "config": {
      "modelType": "coze",
      "apiKey": "***",
      "temperature": 0.8,
      "maxTokens": 2000,
      "model": "coze-bot",
      "botId": "7450790638439907355",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat"
    }
  }
}
[2025-01-05 01:02:14.621] INFO: 接收到的配置数据:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "originalBotId": "7450790638439907355",
    "existingBotId": "7450790638439907355",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-05 01:02:14.621] INFO: 配置更新详情:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "modelType": "coze",
    "model": "coze-bot",
    "hasBotId": true,
    "hasApiKey": true,
    "hasApiUrl": true,
    "botIdType": "string",
    "apiKeyType": "string",
    "apiUrlType": "string",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-05 01:02:14.622] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "botId",
      "apiUrl",
      "temperature",
      "maxTokens",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:02:14.622] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:02:14.635] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:02:14.635] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:02:14.636] INFO: AI助手更新成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "modelType": "coze",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:02:14.760] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:02:14.762] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:02:14.843] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:02:14.845] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:02:32.936] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:02:32.938] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:02:33.016] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:02:33.018] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:02:33.932] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:02:33.934] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:02:35.831] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:02:35.834] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:02:35.834] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:02:35.836] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:02:35.838] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:02:35.838] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:02:35.838] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:02:35.839] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:02:35.839] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:02:35.840] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:02:35.840] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:02:36.033] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105090235247316874840502548BE"
      }
    }
  }
}
[2025-01-05 01:02:36.034] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:02:36.034] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:02:36.035] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:02:36.035] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:02:38.036] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:02:38.037] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:02:38.037] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:02:38.037] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:02:38.037] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:02:38.128] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050902382BDF80CCE7D5AEE72C78"
      }
    }
  }
}
[2025-01-05 01:02:38.128] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:02:38.129] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:02:38.129] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:02:38.129] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:02:42.131] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:02:42.131] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:02:42.132] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:02:42.132] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:02:42.132] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:02:42.213] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105090242FD64422B5CB01E11981F"
      }
    }
  }
}
[2025-01-05 01:02:42.213] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:02:42.214] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:02:42.214] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:02:42.214] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:02:42.214] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:02:42.214] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:02:42.215] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:05:39.935] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:05:39.938] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:05:39.938] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:05:39.941] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:05:39.943] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:05:39.943] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:05:39.943] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:05:39.943] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:05:39.944] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:05:39.944] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:05:39.944] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:05:40.097] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105090540A4F62D8C56342FFBB1C8"
      }
    }
  }
}
[2025-01-05 01:05:40.097] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:05:40.098] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:05:40.098] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:05:40.098] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:05:42.099] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:05:42.100] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:05:42.100] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:05:42.100] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:05:42.101] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:05:42.192] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105090542E11CE4B1E66B2B201E77"
      }
    }
  }
}
[2025-01-05 01:05:42.192] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:05:42.193] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:05:42.193] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:05:42.193] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:05:46.194] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:05:46.195] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:05:46.195] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:05:46.195] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:05:46.196] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "111",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "111"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:05:46.363] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050905463CEB13FAFE9439ED0D24"
      }
    }
  }
}
[2025-01-05 01:05:46.364] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:05:46.364] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:05:46.365] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:05:46.365] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:05:46.365] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:05:46.365] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:05:46.365] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:08:18.582] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:08:18.672] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:08:42.279] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:08:42.282] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:09:03.962] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:10:24.876] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:10:24.965] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:10:37.417] INFO: 开始创建AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "name": "测试助手",
    "type": "general"
  }
}
[2025-01-05 01:10:37.417] ERROR: 创建AI助手失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "crypto.randomBytes is not a function",
    "name": "测试助手",
    "type": "general"
  }
}
[2025-01-05 01:10:37.418] ERROR: 创建AI助手失败: crypto.randomBytes is not a function
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "stack": "ApiError: 创建AI助手失败: crypto.randomBytes is not a function\n    at AiAssistantService.createAssistant (/home/devbox/project/server/services/aiAssistant.service.js:54:19)\n    at exports.createAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:37:52)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.adminAuth (/home/devbox/project/server/middleware/adminAuth.js:13:9)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.auth (/home/devbox/project/server/middleware/auth.js:27:9)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "path": "/api/assistants",
    "method": "POST",
    "body": {
      "name": "测试助手",
      "description": "这是一个测试用的AI助手",
      "type": "general",
      "pointsCost": 1,
      "isActive": true,
      "config": {
        "modelType": "coze",
        "model": "coze-bot",
        "apiKey": "test-api-key",
        "apiUrl": "https://api.coze.cn/open_api/v2/chat",
        "temperature": 0.7,
        "maxTokens": 2000,
        "botId": "test-bot-id"
      }
    },
    "user": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:10:48.118] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:10:48.121] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:10:57.973] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:10:57.975] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:10:57.976] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:10:57.977] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:10:57.979] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:10:57.979] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:10:57.979] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:10:57.980] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:10:57.980] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:10:57.980] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:10:57.980] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": {
      "content": "你好，请问你是做什么的？",
      "role": "user"
    },
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": {
            "content": "你好，请问你是做什么的？",
            "role": "user"
          }
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:10:58.156] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105091058A8DAE7F86D3EA21E5B66"
      }
    }
  }
}
[2025-01-05 01:10:58.157] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:10:58.157] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:10:58.158] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:10:58.158] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:11:00.159] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:11:00.160] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:11:00.160] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:11:00.160] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:11:00.161] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": {
      "content": "你好，请问你是做什么的？",
      "role": "user"
    },
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": {
            "content": "你好，请问你是做什么的？",
            "role": "user"
          }
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:11:00.245] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105091100A35C515BB9739706502C"
      }
    }
  }
}
[2025-01-05 01:11:00.245] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:11:00.245] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:11:00.246] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:11:00.246] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:11:04.247] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:11:04.247] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:11:04.248] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:11:04.248] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:11:04.248] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": {
      "content": "你好，请问你是做什么的？",
      "role": "user"
    },
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": {
            "content": "你好，请问你是做什么的？",
            "role": "user"
          }
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:11:04.324] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050911046E7E5C1B319E9B1B4CF1"
      }
    }
  }
}
[2025-01-05 01:11:04.325] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:11:04.325] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:11:04.325] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:11:04.326] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:11:04.326] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:11:04.327] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:11:04.327] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:11:26.906] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:11:26.908] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:11:26.908] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:11:26.910] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:11:26.912] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:11:26.912] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:11:26.912] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:11:26.912] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:11:26.912] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:11:26.913] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:11:26.913] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:11:27.025] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050911264FA596B8571C931C6EBA"
      }
    }
  }
}
[2025-01-05 01:11:27.026] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:11:27.026] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:11:27.027] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:11:27.027] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:11:29.027] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:11:29.028] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:11:29.028] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:11:29.028] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:11:29.029] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:11:29.110] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050911298657AEC01F1555ED856C"
      }
    }
  }
}
[2025-01-05 01:11:29.111] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:11:29.112] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:11:29.112] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:11:29.112] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:11:33.114] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:11:33.115] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:11:33.115] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:11:33.115] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:11:33.115] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:11:33.204] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010509113386452F06A0219714B0F8"
      }
    }
  }
}
[2025-01-05 01:11:33.204] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:11:33.204] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:11:33.205] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:11:33.205] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:11:33.205] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:11:33.205] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:11:33.206] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:13:07.898] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:13:07.900] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:13:07.901] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:13:07.903] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:13:07.905] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:13:07.905] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:13:07.905] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:13:07.906] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:13:07.906] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:13:07.906] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:13:07.907] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:13:08.012] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010509130704B006E73BCB56121077"
      }
    }
  }
}
[2025-01-05 01:13:08.013] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:13:08.013] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:13:08.014] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:13:08.014] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:13:10.015] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:13:10.016] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:13:10.016] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:13:10.016] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:13:10.017] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:13:10.094] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105091310A58CDD716FE95B1EACCF"
      }
    }
  }
}
[2025-01-05 01:13:10.094] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:13:10.095] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:13:10.095] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:13:10.095] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:13:14.095] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:13:14.096] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:13:14.096] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:13:14.096] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:13:14.096] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:13:14.187] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105091314466A2E2AE9E091EC4027"
      }
    }
  }
}
[2025-01-05 01:13:14.188] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:13:14.188] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:13:14.189] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:13:14.189] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:13:14.189] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:13:14.190] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:13:14.190] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:13:32.712] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:13:32.714] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:13:32.714] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:13:32.716] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:13:32.718] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:13:32.718] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:13:32.718] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:13:32.718] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:13:32.718] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:13:32.719] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:13:32.719] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:13:32.883] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105091332BA9E259D5C0D3FE13DDC"
      }
    }
  }
}
[2025-01-05 01:13:32.884] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:13:32.884] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:13:32.884] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:13:32.885] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:13:34.887] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:13:34.887] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:13:34.888] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:13:34.888] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:13:34.888] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:13:34.988] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050913348465799CDC50E2E483A9"
      }
    }
  }
}
[2025-01-05 01:13:34.988] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:13:34.989] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:13:34.989] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:13:34.989] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:13:38.991] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:13:38.992] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:13:38.992] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:13:38.992] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:13:38.992] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:13:39.082] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105091339DA124CD4C67D8C12E38A"
      }
    }
  }
}
[2025-01-05 01:13:39.082] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:13:39.082] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:13:39.083] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:13:39.083] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:13:39.083] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:13:39.083] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:13:39.083] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:16:20.201] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:16:20.204] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:16:20.279] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:16:20.281] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:19:10.028] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:19:10.116] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:19:38.003] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:19:38.007] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:19:46.859] WARN: 认证失败: 未提供token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:20:27.074] WARN: 认证失败: 未提供token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:20:39.122] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:20:39.209] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:20:53.094] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:21:29.829] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:22:10.720] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:22:28.635] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:22:28.723] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:22:39.855] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:23:12.374] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:23:12.463] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:23:23.326] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:24:10.325] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:24:56.815] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:24:56.903] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:25:08.210] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:25:38.776] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:25:38.864] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:26:01.293] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:26:01.384] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:26:11.007] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:26:11.009] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:26:11.010] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:26:11.012] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:26:11.014] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:26:11.014] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:26:11.015] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:26:11.015] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:26:11.015] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:26:11.016] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:26:11.016] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:26:11.222] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105092611B8C84EB3673150DDDAB0"
      }
    }
  }
}
[2025-01-05 01:26:11.222] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:26:11.223] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:26:11.223] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:26:11.223] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:26:13.224] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:26:13.225] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:26:13.225] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:26:13.225] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:26:13.225] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:26:13.311] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050926137747C2849FC1D642028C"
      }
    }
  }
}
[2025-01-05 01:26:13.311] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:26:13.312] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:26:13.312] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:26:13.312] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:26:17.312] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:26:17.313] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:26:17.313] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:26:17.313] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:26:17.313] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:26:17.468] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010509261788BB2D5E7A21161CAB16"
      }
    }
  }
}
[2025-01-05 01:26:17.468] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:26:17.468] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:26:17.469] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:26:17.469] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:26:17.469] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:26:17.469] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:26:17.470] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:27:26.845] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:27:27.006] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:27:27.041] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:27:27.044] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:27:27.044] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:27:27.048] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:27:27.050] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:27:27.052] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:27:27.052] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:27:27.052] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:27:27.052] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:27:27.052] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:27:27.053] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:27:27.216] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050927271F87F7524D9EA9F2FCC9"
      }
    }
  }
}
[2025-01-05 01:27:27.216] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:27:27.217] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:27:27.217] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:27:27.217] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:27:29.218] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:27:29.219] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:27:29.219] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:27:29.219] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:27:29.219] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:27:29.303] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105092729DBFA950F9C4432256A7F"
      }
    }
  }
}
[2025-01-05 01:27:29.303] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:27:29.304] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:27:29.304] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:27:29.305] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:27:33.305] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:27:33.305] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:27:33.305] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:27:33.306] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:27:33.306] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:27:33.387] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105092733B49CDD6FE4C6CF2585F7"
      }
    }
  }
}
[2025-01-05 01:27:33.388] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:27:33.388] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:27:33.388] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:27:33.389] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:27:33.389] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:27:33.389] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:27:33.390] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:28:04.310] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:28:04.312] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:28:04.312] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:28:04.314] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:28:04.316] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:28:04.316] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:28:04.316] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:28:04.317] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:28:04.317] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:28:04.317] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:28:04.317] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:28:04.453] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050928043B181163BD66A1121B8C"
      }
    }
  }
}
[2025-01-05 01:28:04.453] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:28:04.453] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:28:04.454] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:28:04.454] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:28:06.454] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:28:06.455] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:28:06.455] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:28:06.455] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:28:06.455] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:28:06.541] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105092806A5944D85709CF041ADA1"
      }
    }
  }
}
[2025-01-05 01:28:06.542] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:28:06.542] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:28:06.542] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:28:06.542] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:28:10.543] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:28:10.544] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:28:10.544] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:28:10.544] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:28:10.545] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:28:10.635] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010509281045B3BBD54DE82B3E63EC"
      }
    }
  }
}
[2025-01-05 01:28:10.635] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:28:10.635] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:28:10.636] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:28:10.636] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:28:10.636] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:28:10.636] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:28:10.636] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:29:29.921] WARN: 认证失败: 未提供token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:29:40.052] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:29:40.160] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:29:50.006] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:29:50.008] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:29:50.009] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:29:50.011] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:29:50.012] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:29:50.013] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:29:50.013] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:29:50.013] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:29:50.013] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:29:50.013] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:29:50.013] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:29:50.216] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050929502A29DDB77E14F10D89F6"
      }
    }
  }
}
[2025-01-05 01:29:50.216] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:29:50.216] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:29:50.217] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:29:50.217] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:29:52.218] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:29:52.219] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:29:52.219] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:29:52.219] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:29:52.219] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:29:52.310] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050929523577ACE2AA2C0B04F610"
      }
    }
  }
}
[2025-01-05 01:29:52.310] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:29:52.311] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:29:52.311] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:29:52.311] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:29:56.313] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:29:56.313] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:29:56.313] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:29:56.314] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:29:56.314] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:29:56.390] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010509295617F435155B891F1E876A"
      }
    }
  }
}
[2025-01-05 01:29:56.391] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:29:56.391] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:29:56.391] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:29:56.392] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:29:56.392] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:29:56.392] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:29:56.392] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:30:31.638] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:30:31.641] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:30:31.641] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:30:31.643] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:30:31.645] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:30:31.645] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:30:31.645] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:30:31.645] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:30:31.646] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:30:31.646] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:30:31.646] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:30:31.763] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105093031842331D33016CCD460D6"
      }
    }
  }
}
[2025-01-05 01:30:31.764] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:30:31.764] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:30:31.764] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:30:31.765] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:30:33.767] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:30:33.768] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:30:33.768] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:30:33.768] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:30:33.769] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:30:33.859] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105093033ADF59F8F1107C92D38F1"
      }
    }
  }
}
[2025-01-05 01:30:33.859] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:30:33.860] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:30:33.860] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:30:33.860] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:30:37.862] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:30:37.862] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:30:37.862] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:30:37.863] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:30:37.863] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:30:37.974] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010509303753F450F14CAF5C0C4E76"
      }
    }
  }
}
[2025-01-05 01:30:37.974] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:30:37.975] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:30:37.975] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:30:37.975] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:30:37.976] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:30:37.976] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:30:37.976] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:31:36.661] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:31:36.664] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:31:36.664] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:31:36.666] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:31:36.667] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:31:36.668] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:31:36.668] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:31:36.668] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:31:36.668] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:31:36.668] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:31:36.668] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:31:37.004] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050931365B6BD91E1D50B5E43CF5"
      }
    }
  }
}
[2025-01-05 01:31:37.004] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:31:37.004] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:31:37.005] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:31:37.005] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:31:39.007] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:31:39.007] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:31:39.007] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:31:39.008] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:31:39.008] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:31:39.167] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "2025010509313975387678407F6932564D"
      }
    }
  }
}
[2025-01-05 01:31:39.167] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:31:39.168] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:31:39.168] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:31:39.168] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:31:43.169] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:31:43.170] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:31:43.170] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:31:43.170] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:31:43.170] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:31:43.265] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105093143B0956E72D7D94F1B5F8B"
      }
    }
  }
}
[2025-01-05 01:31:43.265] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:31:43.265] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:31:43.266] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:31:43.266] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:31:43.266] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:31:43.266] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:31:43.266] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:32:04.919] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:32:04.921] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 01:32:04.922] INFO: 通过 key 获取 AI 助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "key": "meituan-service"
  }
}
[2025-01-05 01:32:04.923] INFO: 获取 AI 助手成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "key": "meituan-service",
    "name": "美团全能客服"
  }
}
[2025-01-05 01:32:04.925] INFO: 开始Coze API调用（带重试机制）
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:32:04.925] INFO: 开始重试操作
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "maxAttempts": 3,
    "delay": 2000
  }
}
[2025-01-05 01:32:04.925] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3
  }
}
[2025-01-05 01:32:04.925] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:32:04.925] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:32:04.925] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:32:04.926] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:32:05.137] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "202501050932057428A39124C77911D6B7"
      }
    }
  }
}
[2025-01-05 01:32:05.137] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:32:05.137] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:32:05.138] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 1,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:32:05.138] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 2000
  }
}
[2025-01-05 01:32:07.138] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3
  }
}
[2025-01-05 01:32:07.138] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:32:07.138] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:32:07.139] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:32:07.139] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:32:07.228] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105093207DFA99C9413492E1E5937"
      }
    }
  }
}
[2025-01-05 01:32:07.228] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:32:07.229] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:32:07.229] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 2,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:32:07.229] INFO: 等待后进行下一次尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "nextDelay": 4000
  }
}
[2025-01-05 01:32:11.230] DEBUG: 执行重试尝试
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3
  }
}
[2025-01-05 01:32:11.231] INFO: 收到的完整配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355"
    }
  }
}
[2025-01-05 01:32:11.231] INFO: 开始验证Coze配置:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "configKeys": [
      "modelType",
      "model",
      "apiKey",
      "apiUrl",
      "temperature",
      "maxTokens",
      "botId",
      "systemPrompt"
    ],
    "hasApiKey": true,
    "hasBotId": true,
    "hasApiUrl": true,
    "apiKeyType": "string",
    "botIdType": "string",
    "apiUrlType": "string"
  }
}
[2025-01-05 01:32:11.231] INFO: Coze配置验证通过:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:32:11.231] INFO: 准备发送Coze API请求:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "url": "https://api.coze.cn/open_api/v2/chat",
    "botId": "7450790638439907355",
    "userId": "677426b8bf3ce254abeac7f4",
    "question": "你好，请介绍下你自己",
    "headers": {
      "Authorization": "***",
      "Content-Type": "application/json"
    },
    "payload": {
      "bot_id": "7450790638439907355",
      "messages": [
        {
          "role": "user",
          "content": "你好，请介绍下你自己"
        }
      ],
      "user_id": "677426b8bf3ce254abeac7f4",
      "stream": false
    }
  }
}
[2025-01-05 01:32:11.320] DEBUG: 收到Coze API响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "status": 200,
    "data": {
      "code": 4000,
      "msg": "The field http body provided is not a valid json or chat request. Please check your input.",
      "detail": {
        "logid": "20250105093211D1D8B23034DB7A0822F5"
      }
    }
  }
}
[2025-01-05 01:32:11.321] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-05 01:32:11.321] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-05 01:32:11.321] WARN: 尝试失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "attempt": 3,
    "maxAttempts": 3,
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:32:11.322] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-05 01:32:11.322] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-05 01:32:11.322] INFO: AI助手聊天响应:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "success": false,
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163",
    "modelType": "coze"
  }
}
[2025-01-05 01:32:11.322] WARN: AI助手响应失败，不扣除积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "assistantId": "6778c3a4ecc53bfd8c458163"
  }
}
[2025-01-05 01:37:55.830] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:37:55.917] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:38:16.077] INFO: 开始创建AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "name": "测试助手",
    "type": "general"
  }
}
[2025-01-05 01:38:16.077] ERROR: 创建AI助手失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "crypto.randomBytes is not a function",
    "name": "测试助手",
    "type": "general"
  }
}
[2025-01-05 01:38:16.078] ERROR: 创建AI助手失败: crypto.randomBytes is not a function
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "stack": "ApiError: 创建AI助手失败: crypto.randomBytes is not a function\n    at AiAssistantService.createAssistant (/home/devbox/project/server/services/aiAssistant.service.js:54:19)\n    at exports.createAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:37:52)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.adminAuth (/home/devbox/project/server/middleware/adminAuth.js:13:9)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.auth (/home/devbox/project/server/middleware/auth.js:27:9)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "path": "/api/assistants",
    "method": "POST",
    "body": {
      "name": "测试助手",
      "description": "这是一个测试用的AI助手",
      "type": "general",
      "pointsCost": 1,
      "config": {
        "modelType": "coze",
        "apiKey": "sk-0123456789abcdef",
        "botId": "bot_0123456789",
        "apiUrl": "https://api.coze.cn/open_api/v2/chat",
        "temperature": 0.7,
        "maxTokens": 2000
      },
      "isActive": true
    },
    "user": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:38:41.469] INFO: 开始创建AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "name": "测试助手",
    "type": "general"
  }
}
[2025-01-05 01:38:41.469] ERROR: 创建AI助手失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "crypto.randomBytes is not a function",
    "name": "测试助手",
    "type": "general"
  }
}
[2025-01-05 01:38:41.470] ERROR: 创建AI助手失败: crypto.randomBytes is not a function
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "stack": "ApiError: 创建AI助手失败: crypto.randomBytes is not a function\n    at AiAssistantService.createAssistant (/home/devbox/project/server/services/aiAssistant.service.js:54:19)\n    at exports.createAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:37:52)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.adminAuth (/home/devbox/project/server/middleware/adminAuth.js:13:9)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.auth (/home/devbox/project/server/middleware/auth.js:27:9)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "path": "/api/assistants",
    "method": "POST",
    "body": {
      "name": "测试助手",
      "description": "这是一个测试用的AI助手",
      "type": "general",
      "pointsCost": 1,
      "config": {
        "modelType": "coze",
        "apiKey": "sk-0123456789abcdef",
        "botId": "bot_0123456789",
        "apiUrl": "https://api.coze.cn/open_api/v2/chat",
        "temperature": 0.7,
        "maxTokens": 2000
      },
      "isActive": true
    },
    "user": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:39:06.193] INFO: 开始创建AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "name": "测试助手",
    "type": "general"
  }
}
[2025-01-05 01:39:06.194] ERROR: 创建AI助手失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "crypto.randomBytes is not a function",
    "name": "测试助手",
    "type": "general"
  }
}
[2025-01-05 01:39:06.194] ERROR: 创建AI助手失败: crypto.randomBytes is not a function
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "stack": "ApiError: 创建AI助手失败: crypto.randomBytes is not a function\n    at AiAssistantService.createAssistant (/home/devbox/project/server/services/aiAssistant.service.js:54:19)\n    at exports.createAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:37:52)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.adminAuth (/home/devbox/project/server/middleware/adminAuth.js:13:9)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.auth (/home/devbox/project/server/middleware/auth.js:27:9)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "path": "/api/assistants",
    "method": "POST",
    "body": {
      "name": "测试助手",
      "description": "这是一个测试用的AI助手",
      "type": "general",
      "pointsCost": 1,
      "config": {
        "modelType": "coze",
        "apiKey": "sk-0123456789abcdef",
        "botId": "bot_0123456789",
        "apiUrl": "https://api.coze.cn/open_api/v2/chat",
        "temperature": 0.7,
        "maxTokens": 2000
      },
      "isActive": true
    },
    "user": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:39:30.220] ERROR: uncaughtException: Route.get() requires a callback function but got a [object Undefined]
Error: Route.get() requires a callback function but got a [object Undefined]
    at Route.<computed> [as get] (/home/devbox/project/node_modules/express/lib/router/route.js:216:15)
    at proto.<computed> [as get] (/home/devbox/project/node_modules/express/lib/router/index.js:521:19)
    at Object.<anonymous> (/home/devbox/project/server/routes/aiAssistant.routes.js:12:8)
    at Module._compile (node:internal/modules/cjs/loader:1546:14)
    at Object..js (node:internal/modules/cjs/loader:1689:10)
    at Module.load (node:internal/modules/cjs/loader:1318:32)
    at Function._load (node:internal/modules/cjs/loader:1128:12)
    at TracingChannel.traceSync (node:diagnostics_channel:315:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:218:24)
    at Module.require (node:internal/modules/cjs/loader:1340:12)
Details: {
  "metadata": {
    "error": {},
    "stack": "Error: Route.get() requires a callback function but got a [object Undefined]\n    at Route.<computed> [as get] (/home/devbox/project/node_modules/express/lib/router/route.js:216:15)\n    at proto.<computed> [as get] (/home/devbox/project/node_modules/express/lib/router/index.js:521:19)\n    at Object.<anonymous> (/home/devbox/project/server/routes/aiAssistant.routes.js:12:8)\n    at Module._compile (node:internal/modules/cjs/loader:1546:14)\n    at Object..js (node:internal/modules/cjs/loader:1689:10)\n    at Module.load (node:internal/modules/cjs/loader:1318:32)\n    at Function._load (node:internal/modules/cjs/loader:1128:12)\n    at TracingChannel.traceSync (node:diagnostics_channel:315:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:218:24)\n    at Module.require (node:internal/modules/cjs/loader:1340:12)",
    "exception": true,
    "date": "Sun Jan 05 2025 01:39:30 GMT+0000 (Coordinated Universal Time)",
    "process": {
      "pid": 11761,
      "uid": 1000,
      "gid": 1000,
      "cwd": "/home/devbox/project",
      "execPath": "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
      "version": "v22.11.0",
      "argv": [
        "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
        "/home/devbox/project/server/app.js"
      ],
      "memoryUsage": {
        "rss": 91971584,
        "heapTotal": 36560896,
        "heapUsed": 26419792,
        "external": 21412971,
        "arrayBuffers": 18311345
      }
    },
    "os": {
      "loadavg": [
        3.42,
        3.33,
        2.95
      ],
      "uptime": 3784744.88
    },
    "trace": [
      {
        "column": 15,
        "file": "/home/devbox/project/node_modules/express/lib/router/route.js",
        "function": "Route.<computed> [as get]",
        "line": 216,
        "method": "<computed> [as get]",
        "native": false
      },
      {
        "column": 19,
        "file": "/home/devbox/project/node_modules/express/lib/router/index.js",
        "function": "proto.<computed> [as get]",
        "line": 521,
        "method": "<computed> [as get]",
        "native": false
      },
      {
        "column": 8,
        "file": "/home/devbox/project/server/routes/aiAssistant.routes.js",
        "function": null,
        "line": 12,
        "method": null,
        "native": false
      },
      {
        "column": 14,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module._compile",
        "line": 1546,
        "method": "_compile",
        "native": false
      },
      {
        "column": 10,
        "file": "node:internal/modules/cjs/loader",
        "function": "Object..js",
        "line": 1689,
        "method": ".js",
        "native": false
      },
      {
        "column": 32,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module.load",
        "line": 1318,
        "method": "load",
        "native": false
      },
      {
        "column": 12,
        "file": "node:internal/modules/cjs/loader",
        "function": "Function._load",
        "line": 1128,
        "method": "_load",
        "native": false
      },
      {
        "column": 14,
        "file": "node:diagnostics_channel",
        "function": "TracingChannel.traceSync",
        "line": 315,
        "method": "traceSync",
        "native": false
      },
      {
        "column": 24,
        "file": "node:internal/modules/cjs/loader",
        "function": "wrapModuleLoad",
        "line": 218,
        "method": null,
        "native": false
      },
      {
        "column": 12,
        "file": "node:internal/modules/cjs/loader",
        "function": "Module.require",
        "line": 1340,
        "method": "require",
        "native": false
      }
    ],
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:41:03.305] INFO: 数据库连接成功
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:41:03.308] INFO: MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:41:03.312] INFO: 服务器已启动，监听端口 3000
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:41:03.312] INFO: 环境: development
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:41:03.313] INFO: API版本: 1.0.0
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:42:56.680] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:42:56.683] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/-----1736041364227-8415/chat"
  }
}
[2025-01-05 01:43:16.839] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e394bc9ae6bfb80d430e",
    "config": {
      "modelType": "coze",
      "apiKey": "***",
      "botId": "bot_0e3c5c0c5c0c5c0c5c0c5c0c",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat"
    }
  }
}
[2025-01-05 01:43:16.841] INFO: 接收到的配置数据:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "originalBotId": "bot_0e3c5c0c5c0c5c0c5c0c5c0c",
    "existingBotId": "test-bot",
    "finalBotId": "bot_0e3c5c0c5c0c5c0c5c0c5c0c"
  }
}
[2025-01-05 01:43:16.842] INFO: 配置更新详情:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "modelType": "coze",
    "model": "coze-bot",
    "hasBotId": true,
    "hasApiKey": true,
    "hasApiUrl": true,
    "botIdType": "string",
    "apiKeyType": "string",
    "apiUrlType": "string",
    "finalBotId": "bot_0e3c5c0c5c0c5c0c5c0c5c0c"
  }
}
[2025-01-05 01:43:16.851] INFO: AI助手更新成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e394bc9ae6bfb80d430e",
    "name": "测试助手",
    "type": "general",
    "modelType": "coze",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:43:28.370] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:43:28.372] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/-----1736041364227-8415/chat"
  }
}
[2025-01-05 01:44:00.106] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e394bc9ae6bfb80d430e",
    "config": {
      "modelType": "coze",
      "apiKey": "***",
      "botId": "7450790638439907355",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat"
    }
  }
}
[2025-01-05 01:44:00.108] INFO: 接收到的配置数据:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "originalBotId": "7450790638439907355",
    "existingBotId": "bot_0e3c5c0c5c0c5c0c5c0c5c0c",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-05 01:44:00.109] INFO: 配置更新详情:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "modelType": "coze",
    "model": "coze-bot",
    "hasBotId": true,
    "hasApiKey": true,
    "hasApiUrl": true,
    "botIdType": "string",
    "apiKeyType": "string",
    "apiUrlType": "string",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-05 01:44:00.114] INFO: AI助手更新成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e394bc9ae6bfb80d430e",
    "name": "测试助手",
    "type": "general",
    "modelType": "coze",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:44:12.294] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:44:12.296] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/-----1736041364227-8415/chat"
  }
}
[2025-01-05 01:44:38.038] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:44:38.041] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/-----1736041364227-8415/chat"
  }
}
[2025-01-05 01:45:07.104] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:45:07.106] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/-----1736041364227-8415/chat"
  }
}
[2025-01-05 01:46:04.402] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:46:04.404] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/-----1736041364227-8415/chat"
  }
}
[2025-01-05 01:46:15.183] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:46:15.186] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/-----1736041364227-8415/chat"
  }
}
[2025-01-05 01:46:26.477] INFO: 数据库连接成功
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:46:26.480] INFO: MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:46:26.486] ERROR: uncaughtException: listen EADDRINUSE: address already in use :::3000
Error: listen EADDRINUSE: address already in use :::3000
    at Server.setupListenHandle [as _listen2] (node:net:1907:16)
    at listenInCluster (node:net:1964:12)
    at Server.listen (node:net:2066:7)
    at Function.listen (/home/devbox/project/node_modules/express/lib/application.js:635:24)
    at /home/devbox/project/server/app.js:82:9
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
Details: {
  "metadata": {
    "error": {
      "code": "EADDRINUSE",
      "errno": -98,
      "syscall": "listen",
      "address": "::",
      "port": 3000
    },
    "stack": "Error: listen EADDRINUSE: address already in use :::3000\n    at Server.setupListenHandle [as _listen2] (node:net:1907:16)\n    at listenInCluster (node:net:1964:12)\n    at Server.listen (node:net:2066:7)\n    at Function.listen (/home/devbox/project/node_modules/express/lib/application.js:635:24)\n    at /home/devbox/project/server/app.js:82:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "exception": true,
    "date": "Sun Jan 05 2025 01:46:26 GMT+0000 (Coordinated Universal Time)",
    "process": {
      "pid": 13879,
      "uid": 1000,
      "gid": 1000,
      "cwd": "/home/devbox/project",
      "execPath": "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
      "version": "v22.11.0",
      "argv": [
        "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
        "/home/devbox/project/server/app.js"
      ],
      "memoryUsage": {
        "rss": 96911360,
        "heapTotal": 40386560,
        "heapUsed": 26516808,
        "external": 21668685,
        "arrayBuffers": 18325613
      }
    },
    "os": {
      "loadavg": [
        3.5,
        3.48,
        3.14
      ],
      "uptime": 3785161.14
    },
    "trace": [
      {
        "column": 16,
        "file": "node:net",
        "function": "Server.setupListenHandle [as _listen2]",
        "line": 1907,
        "method": "setupListenHandle [as _listen2]",
        "native": false
      },
      {
        "column": 12,
        "file": "node:net",
        "function": "listenInCluster",
        "line": 1964,
        "method": null,
        "native": false
      },
      {
        "column": 7,
        "file": "node:net",
        "function": "Server.listen",
        "line": 2066,
        "method": "listen",
        "native": false
      },
      {
        "column": 24,
        "file": "/home/devbox/project/node_modules/express/lib/application.js",
        "function": "Function.listen",
        "line": 635,
        "method": "listen",
        "native": false
      },
      {
        "column": 9,
        "file": "/home/devbox/project/server/app.js",
        "function": null,
        "line": 82,
        "method": null,
        "native": false
      },
      {
        "column": 5,
        "file": "node:internal/process/task_queues",
        "function": "process.processTicksAndRejections",
        "line": 105,
        "method": "processTicksAndRejections",
        "native": false
      }
    ],
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:46:34.646] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:46:34.649] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/-----1736041364227-8415/chat"
  }
}
[2025-01-05 01:47:28.017] INFO: 数据库连接成功
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:47:28.020] INFO: MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:47:28.025] ERROR: uncaughtException: listen EADDRINUSE: address already in use :::3000
Error: listen EADDRINUSE: address already in use :::3000
    at Server.setupListenHandle [as _listen2] (node:net:1907:16)
    at listenInCluster (node:net:1964:12)
    at Server.listen (node:net:2066:7)
    at Function.listen (/home/devbox/project/node_modules/express/lib/application.js:635:24)
    at /home/devbox/project/server/app.js:82:9
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
Details: {
  "metadata": {
    "error": {
      "code": "EADDRINUSE",
      "errno": -98,
      "syscall": "listen",
      "address": "::",
      "port": 3000
    },
    "stack": "Error: listen EADDRINUSE: address already in use :::3000\n    at Server.setupListenHandle [as _listen2] (node:net:1907:16)\n    at listenInCluster (node:net:1964:12)\n    at Server.listen (node:net:2066:7)\n    at Function.listen (/home/devbox/project/node_modules/express/lib/application.js:635:24)\n    at /home/devbox/project/server/app.js:82:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "exception": true,
    "date": "Sun Jan 05 2025 01:47:28 GMT+0000 (Coordinated Universal Time)",
    "process": {
      "pid": 14014,
      "uid": 1000,
      "gid": 1000,
      "cwd": "/home/devbox/project",
      "execPath": "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
      "version": "v22.11.0",
      "argv": [
        "/home/devbox/.nvm/versions/node/v22.11.0/bin/node",
        "/home/devbox/project/server/app.js"
      ],
      "memoryUsage": {
        "rss": 97177600,
        "heapTotal": 40124416,
        "heapUsed": 26494344,
        "external": 21668685,
        "arrayBuffers": 18325613
      }
    },
    "os": {
      "loadavg": [
        3.26,
        3.42,
        3.14
      ],
      "uptime": 3785222.68
    },
    "trace": [
      {
        "column": 16,
        "file": "node:net",
        "function": "Server.setupListenHandle [as _listen2]",
        "line": 1907,
        "method": "setupListenHandle [as _listen2]",
        "native": false
      },
      {
        "column": 12,
        "file": "node:net",
        "function": "listenInCluster",
        "line": 1964,
        "method": null,
        "native": false
      },
      {
        "column": 7,
        "file": "node:net",
        "function": "Server.listen",
        "line": 2066,
        "method": "listen",
        "native": false
      },
      {
        "column": 24,
        "file": "/home/devbox/project/node_modules/express/lib/application.js",
        "function": "Function.listen",
        "line": 635,
        "method": "listen",
        "native": false
      },
      {
        "column": 9,
        "file": "/home/devbox/project/server/app.js",
        "function": null,
        "line": 82,
        "method": null,
        "native": false
      },
      {
        "column": 5,
        "file": "node:internal/process/task_queues",
        "function": "process.processTicksAndRejections",
        "line": 105,
        "method": "processTicksAndRejections",
        "native": false
      }
    ],
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:48:27.150] INFO: 数据库连接成功
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:48:27.153] INFO: MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:48:27.157] INFO: 服务器已启动，监听端口 3000
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:48:27.157] INFO: 环境: development
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:48:27.158] INFO: API版本: 1.0.0
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 01:48:36.585] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:48:36.596] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/-----1736041364227-8415/chat"
  }
}
[2025-01-05 01:52:26.008] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e394bc9ae6bfb80d430e",
    "name": "更新后的助手",
    "type": "professional",
    "config": {
      "modelType": "coze",
      "apiKey": "***",
      "botId": "7450790638439907355",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat"
    }
  }
}
[2025-01-05 01:52:26.011] INFO: 接收到的配置数据:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "originalBotId": "7450790638439907355",
    "existingBotId": "7450790638439907355",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-05 01:52:26.011] INFO: 配置更新详情:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "modelType": "coze",
    "model": "coze-bot",
    "hasBotId": true,
    "hasApiKey": true,
    "hasApiUrl": true,
    "botIdType": "string",
    "apiKeyType": "string",
    "apiUrlType": "string",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-05 01:52:26.019] ERROR: 更新AI助手失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "Validation failed: type: 无效的AI助手类型",
    "id": "6779e394bc9ae6bfb80d430e",
    "name": "更新后的助手"
  }
}
[2025-01-05 01:52:38.945] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e394bc9ae6bfb80d430e",
    "name": "更新后的助手",
    "type": "professional",
    "config": {
      "modelType": "coze",
      "apiKey": "***",
      "botId": "7450790638439907355",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat"
    }
  }
}
[2025-01-05 01:52:38.948] INFO: 接收到的配置数据:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "originalBotId": "7450790638439907355",
    "existingBotId": "7450790638439907355",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-05 01:52:38.949] INFO: 配置更新详情:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "modelType": "coze",
    "model": "coze-bot",
    "hasBotId": true,
    "hasApiKey": true,
    "hasApiUrl": true,
    "botIdType": "string",
    "apiKeyType": "string",
    "apiUrlType": "string",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-05 01:52:38.950] ERROR: 更新AI助手失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "Validation failed: type: 无效的AI助手类型",
    "id": "6779e394bc9ae6bfb80d430e",
    "name": "更新后的助手"
  }
}
[2025-01-05 01:52:49.593] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e394bc9ae6bfb80d430e",
    "name": "更新后的助手",
    "type": "professional"
  }
}
[2025-01-05 01:52:49.596] ERROR: 更新AI助手失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "Validation failed: type: 无效的AI助手类型",
    "id": "6779e394bc9ae6bfb80d430e",
    "name": "更新后的助手"
  }
}
[2025-01-05 01:53:01.985] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:53:01.989] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e394bc9ae6bfb80d430e",
        "name": "测试助手",
        "key": "-----1736041364227-8415",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:53:22.718] INFO: 开始删除AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e394bc9ae6bfb80d430e"
  }
}
[2025-01-05 01:53:22.723] INFO: AI助手删除成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e394bc9ae6bfb80d430e",
    "name": "测试助手",
    "type": "general"
  }
}
[2025-01-05 01:53:34.214] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:53:34.216] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:55:08.453] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e5acbc9ae6bfb80d4310",
    "name": "更新后的助手",
    "type": "general"
  }
}
[2025-01-05 01:55:08.455] ERROR: 更新AI助手失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "找不到指定的AI助手",
    "id": "6779e5acbc9ae6bfb80d4310",
    "name": "更新后的助手"
  }
}
[2025-01-05 01:55:20.203] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:55:20.206] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e66cd22eadb0858e8c3b",
        "name": "测试助手",
        "key": "-----1736042092901-7942",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:55:33.274] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e66cd22eadb0858e8c3b",
    "name": "更新后的助手",
    "type": "general"
  }
}
[2025-01-05 01:55:33.280] INFO: AI助手更新成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e66cd22eadb0858e8c3b",
    "name": "更新后的助手",
    "type": "general",
    "modelType": "coze",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:55:59.949] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 01:56:00.053] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 01:56:00.819] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:56:00.822] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e66cd22eadb0858e8c3b",
        "name": "更新后的助手",
        "key": "-----1736042092901-7942",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:56:00.857] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:56:00.860] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e66cd22eadb0858e8c3b",
        "name": "更新后的助手",
        "key": "-----1736042092901-7942",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:56:04.007] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:56:04.011] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 01:56:04.011] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 01:56:04.054] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:56:04.056] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 01:56:04.056] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 01:56:05.294] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:56:05.297] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e66cd22eadb0858e8c3b",
        "name": "更新后的助手",
        "key": "-----1736042092901-7942",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:56:05.368] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:56:05.371] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e66cd22eadb0858e8c3b",
        "name": "更新后的助手",
        "key": "-----1736042092901-7942",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:56:10.786] INFO: 开始删除AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e66cd22eadb0858e8c3b"
  }
}
[2025-01-05 01:56:10.789] INFO: AI助手删除成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e66cd22eadb0858e8c3b",
    "name": "更新后的助手",
    "type": "general"
  }
}
[2025-01-05 01:56:10.903] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:56:10.907] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:56:10.981] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:56:10.985] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:57:30.495] INFO: 开始删除AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e66cd22eadb0858e8c3b"
  }
}
[2025-01-05 01:57:30.497] WARN: 删除AI助手失败: 找不到指定的AI助手
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e66cd22eadb0858e8c3b"
  }
}
[2025-01-05 01:57:30.497] ERROR: 删除AI助手失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "找不到指定的AI助手",
    "id": "6779e66cd22eadb0858e8c3b"
  }
}
[2025-01-05 01:57:50.876] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:57:50.879] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:57:57.439] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:57:57.442] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:58:08.014] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:58:08.037] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:58:24.385] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "config": {
      "modelType": "coze",
      "apiKey": "***",
      "temperature": 0.8,
      "maxTokens": 2000,
      "model": "coze-bot",
      "botId": "7450790638439907355",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat"
    }
  }
}
[2025-01-05 01:58:24.387] INFO: 接收到的配置数据:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "originalBotId": "7450790638439907355",
    "existingBotId": "7450790638439907355",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-05 01:58:24.387] INFO: 配置更新详情:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "modelType": "coze",
    "model": "coze-bot",
    "hasBotId": true,
    "hasApiKey": true,
    "hasApiUrl": true,
    "botIdType": "string",
    "apiKeyType": "string",
    "apiUrlType": "string",
    "finalBotId": "7450790638439907355"
  }
}
[2025-01-05 01:58:24.392] INFO: AI助手更新成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6778c3a4ecc53bfd8c458163",
    "name": "美团全能客服",
    "type": "general",
    "modelType": "coze",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 01:58:24.534] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:58:24.537] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:58:24.626] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:58:24.629] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:58:36.635] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:58:36.638] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:58:36.676] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:58:36.678] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:58:37.484] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:58:37.487] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:58:39.665] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:58:39.668] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 01:58:39.668] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 01:58:39.729] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 01:58:39.732] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 01:58:39.732] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 01:58:41.852] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:58:41.855] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 01:58:41.924] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 01:58:41.926] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 2,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:01:20.228] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:01:20.231] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:01:20.270] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:01:20.273] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:01:30.105] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:01:30.107] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:01:30.184] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:01:30.187] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:01:32.149] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:01:32.152] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:02:24.468] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:02:24.470] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:02:24.470] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:02:24.537] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:02:24.539] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:02:24.540] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:02:26.032] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:02:26.035] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:02:26.068] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:02:26.071] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:02:52.123] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e7f0d22eadb0858e8c60",
    "name": "美团分类栏描述",
    "type": "general",
    "config": {
      "modelType": "coze",
      "apiKey": "***",
      "temperature": 0.7,
      "maxTokens": 2000,
      "model": "coze-bot",
      "botId": "7444769224897085503",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat"
    }
  }
}
[2025-01-05 02:02:52.125] INFO: 接收到的配置数据:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "originalBotId": "7444769224897085503",
    "existingBotId": "7444769224897085503",
    "finalBotId": "7444769224897085503"
  }
}
[2025-01-05 02:02:52.125] INFO: 配置更新详情:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "modelType": "coze",
    "model": "coze-bot",
    "hasBotId": true,
    "hasApiKey": true,
    "hasApiUrl": true,
    "botIdType": "string",
    "apiKeyType": "string",
    "apiUrlType": "string",
    "finalBotId": "7444769224897085503"
  }
}
[2025-01-05 02:02:52.130] INFO: AI助手更新成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779e7f0d22eadb0858e8c60",
    "name": "美团分类栏描述",
    "type": "general",
    "modelType": "coze",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 02:02:52.238] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:02:52.241] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:02:52.323] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:02:52.325] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:02:57.164] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 02:02:57.256] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 02:02:57.895] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:02:57.898] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:02:57.958] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:02:57.961] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:02:59.707] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:02:59.710] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:03:04.126] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:03:04.129] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:03:04.561] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:03:04.563] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:03:17.826] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:03:17.829] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:03:17.830] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:03:17.893] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:03:17.895] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:03:17.895] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:03:18.698] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:03:18.702] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:03:18.736] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:03:18.740] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:05:23.599] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:05:23.601] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:06:31.272] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:06:31.275] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:06:31.308] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:06:31.311] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:06:32.199] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:06:32.201] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:06:36.606] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:36.608] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:06:43.054] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:43.056] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 02:06:43.162] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:43.164] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:06:43.164] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:43.167] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:06:47.034] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:47.036] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 02:06:47.074] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:47.076] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:06:47.076] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:47.078] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:06:50.923] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:50.926] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:06:50.926] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:06:50.987] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:50.990] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:06:50.990] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:06:52.150] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:52.153] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:06:52.153] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:06:52.188] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:52.190] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:06:52.190] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:06:53.745] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:53.747] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:06:53.748] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:06:53.750] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:06:57.446] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:06:57.449] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:06:57.483] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:06:57.486] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:06:58.594] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:06:58.597] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:07:00.212] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:07:00.215] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:07:02.085] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:07:02.087] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:07:08.267] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:07:08.269] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/--------1736042480141-4311/chat"
  }
}
[2025-01-05 02:07:27.469] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:07:27.472] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 02:07:27.573] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:07:27.575] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:07:27.575] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:07:27.578] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:07:32.321] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:07:32.323] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:07:32.323] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:07:32.386] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:07:32.388] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:07:32.388] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:07:33.789] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:07:33.793] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:07:33.827] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:07:33.832] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:07:37.437] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:07:37.439] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:07:37.440] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:07:37.512] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:07:37.515] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:07:37.515] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:07:38.704] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:07:38.706] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:07:38.706] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:07:38.709] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 39,
    "records": [
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      },
      {
        "_id": "67793ea7d3a0b352f6fb36ed",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1225,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T13:59:03.341Z",
        "updatedAt": "2025-01-04T13:59:03.341Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:07:41.469] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:07:41.472] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:07:41.516] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:07:41.518] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:07:42.688] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:07:42.691] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:07:47.618] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:07:47.621] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:08:05.784] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:08:05.786] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:08:05.786] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:08:05.835] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:08:05.837] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:08:05.837] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:08:07.349] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:08:07.352] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:08:07.430] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:08:07.432] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:08:13.013] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:08:13.016] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:08:13.052] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:08:13.054] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:11:27.360] INFO: 开始更新AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779ea43d22eadb0858e8cb1",
    "name": "更新的测试日志格式",
    "type": "general"
  }
}
[2025-01-05 02:11:27.366] INFO: AI助手更新成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779ea43d22eadb0858e8cb1",
    "name": "更新的测试日志格式",
    "type": "general",
    "modelType": "coze",
    "hasBotId": true,
    "hasApiKey": true
  }
}
[2025-01-05 02:11:39.806] INFO: 开始删除AI助手:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779ea43d22eadb0858e8cb1"
  }
}
[2025-01-05 02:11:39.810] INFO: AI助手删除成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "id": "6779ea43d22eadb0858e8cb1",
    "name": "更新的测试日志格式",
    "type": "general"
  }
}
[2025-01-05 02:12:05.264] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:05.267] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:12:05.268] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:12:05.369] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:05.371] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:12:05.371] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:12:10.443] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:10.446] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points"
  }
}
[2025-01-05 02:12:10.446] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points"
  }
}
[2025-01-05 02:12:10.447] INFO: 尝试更新用户积分:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "newPoints": 1322,
    "adminId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:10.458] INFO: 积分更新成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "oldPoints": 1222,
    "newPoints": 1322,
    "pointsDiff": 100,
    "adminId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:10.598] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:10.601] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:12:10.601] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:12:12.185] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:12.187] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:12:12.187] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:12.190] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:12:20.162] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:12:20.165] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:12:20.198] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:12:20.201] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:12:23.130] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:23.133] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 02:12:23.211] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:23.214] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:12:23.214] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:23.216] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:12:29.283] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:12:29.286] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:12:32.761] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:32.764] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:12:47.231] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:47.233] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:12:47.234] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:12:47.299] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:47.301] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:12:47.302] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:12:48.839] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:12:48.842] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:12:48.913] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:12:48.915] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:12:50.208] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:50.210] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:12:50.211] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:12:50.248] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:50.251] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:12:50.252] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:12:51.286] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:51.288] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:12:51.289] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:12:51.291] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:15:18.694] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:15:18.697] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:15:21.132] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:15:21.134] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:15:30.468] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:15:30.470] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 02:15:30.591] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:15:30.593] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:15:30.594] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:15:30.597] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:15:34.371] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:15:34.374] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:15:34.374] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:15:34.432] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:15:34.436] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:15:34.436] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:15:35.739] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:15:35.742] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:15:35.774] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:15:35.777] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:15:36.504] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:15:36.506] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:15:36.506] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:15:36.542] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:15:36.544] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:15:36.544] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:15:37.692] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:15:37.695] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:15:37.695] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:15:37.698] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:17:35.708] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:17:35.711] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:17:35.746] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:17:35.749] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:17:36.299] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:17:36.301] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:17:38.991] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:17:38.993] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:17:48.764] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:17:48.766] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 02:17:48.869] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:17:48.871] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:17:48.871] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:17:48.874] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:17:52.333] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:17:52.335] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:17:52.335] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:17:52.400] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:17:52.402] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:17:52.403] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:17:53.643] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:17:53.646] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:17:53.681] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:17:53.684] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:17:54.870] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:17:54.873] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:17:54.873] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:17:54.945] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:17:54.947] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:17:54.947] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:17:55.853] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:17:55.855] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:17:55.855] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:17:55.857] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:17:58.340] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:17:58.343] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:17:58.377] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:17:58.379] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:19:53.519] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:19:53.522] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:19:58.413] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:19:58.415] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:20:10.674] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:20:10.676] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 02:20:10.801] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:20:10.804] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:20:10.804] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:20:10.806] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:20:14.123] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:20:14.126] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:20:14.126] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:20:14.184] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:20:14.187] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:20:14.187] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:20:15.482] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:20:15.486] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:20:15.519] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:20:15.523] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:20:16.722] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:20:16.725] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:20:16.725] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:20:16.804] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:20:16.806] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:20:16.806] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:20:17.977] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:20:17.980] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:20:17.980] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:20:17.982] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:20:56.781] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:20:56.784] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:22:07.562] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 02:22:17.634] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 02:22:51.956] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 02:22:52.044] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 02:23:01.555] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:23:01.557] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:23:01.558] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:23:01.559] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:23:57.582] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:23:57.584] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/6778c3a4ecc53bfd8c458163/chat"
  }
}
[2025-01-05 02:24:07.361] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:24:07.364] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:24:07.364] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:24:07.366] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:24:19.573] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:24:19.576] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:24:33.485] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:24:33.487] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:24:49.957] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:24:49.960] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:24:49.960] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:24:49.962] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:25:24.015] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:25:24.017] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:25:41.611] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:25:41.614] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:25:41.614] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:25:41.616] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:26:16.794] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:26:16.796] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:26:33.984] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:26:33.987] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:26:33.987] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:26:33.989] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:27:10.246] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:27:10.249] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:27:26.805] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:27:26.808] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:27:26.808] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:27:26.810] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:28:00.352] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:28:00.354] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:28:18.242] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:28:18.244] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:28:18.245] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:28:18.246] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:28:51.812] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:28:51.814] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:29:09.266] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:29:09.268] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:29:09.269] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:29:09.270] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:30:12.875] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:30:12.878] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:30:28.095] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:30:28.097] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:30:28.098] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:30:28.100] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:31:14.744] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:31:14.746] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:31:46.325] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:31:46.328] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:31:46.328] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:31:46.330] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:32:06.478] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:32:06.481] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:32:06.553] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:32:06.556] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:32:07.275] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:32:07.278] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:32:09.926] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:32:09.929] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 02:32:21.943] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:32:21.945] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 02:32:22.017] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:32:22.019] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:32:22.019] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:32:22.021] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:32:25.970] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:32:25.973] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:32:25.973] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:32:26.008] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:32:26.010] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:32:26.011] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 02:32:27.138] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:32:27.141] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:32:27.211] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:32:27.214] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:32:28.664] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:32:28.666] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:32:28.666] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:32:28.701] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:32:28.703] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:32:28.703] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 02:32:29.924] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:32:29.927] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 02:32:29.927] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 02:32:29.930] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 02:32:32.293] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:32:32.296] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:32:32.330] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:32:32.332] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 02:32:33.927] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 02:32:33.930] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 05:37:21.377] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:37:21.380] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/me"
  }
}
[2025-01-05 05:37:21.490] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:37:21.492] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 05:37:21.492] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:37:21.494] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 05:37:26.694] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:37:26.696] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 05:37:26.697] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 05:37:26.760] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:37:26.762] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 05:37:26.763] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/stats"
  }
}
[2025-01-05 05:37:28.415] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 05:37:28.418] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 05:37:28.495] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 05:37:28.497] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 05:37:30.899] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:37:30.901] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 05:37:30.902] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 05:37:30.937] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:37:30.940] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 05:37:30.940] DEBUG: 用户授权成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/"
  }
}
[2025-01-05 05:37:32.380] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:37:32.382] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 05:37:32.383] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:37:32.385] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 05:37:34.598] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 05:37:34.601] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 05:37:34.641] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 05:37:34.644] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 05:37:36.911] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 05:37:36.914] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 05:38:52.902] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:38:52.905] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 05:39:07.623] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:39:07.626] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 05:39:07.626] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:39:07.628] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 05:39:49.150] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 05:39:59.429] INFO: 用户尝试登录:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "email": "admin@example.com"
  }
}
[2025-01-05 05:39:59.530] INFO: 用户登录成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "email": "admin@example.com",
    "role": "admin"
  }
}
[2025-01-05 05:40:11.055] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:40:11.057] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/test-assistant-1/chat"
  }
}
[2025-01-05 05:41:04.733] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:41:04.735] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 05:41:25.735] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:41:25.737] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 05:41:25.737] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:41:25.740] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 05:41:51.752] INFO: 获取AI助手列表:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "query": {}
  }
}
[2025-01-05 05:41:51.755] INFO: 获取AI助手列表成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "count": 3,
    "query": {},
    "assistants": [
      {
        "id": "6778c3a4ecc53bfd8c458163",
        "name": "美团全能客服",
        "key": "meituan-service",
        "isActive": true
      },
      {
        "id": "6778e3cd61261a424ab4644e",
        "name": "美团品牌定位设计",
        "key": "---------a187a314",
        "isActive": true
      },
      {
        "id": "6779e7f0d22eadb0858e8c60",
        "name": "美团分类栏描述",
        "key": "--------1736042480141-4311",
        "isActive": true
      }
    ]
  }
}
[2025-01-05 05:42:37.216] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:42:37.218] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/meituan-service/chat"
  }
}
[2025-01-05 05:42:58.299] DEBUG: Token验证成功:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:42:58.301] DEBUG: 用户认证成功
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "role": "admin",
    "path": "/677426b8bf3ce254abeac7f4/points/history"
  }
}
[2025-01-05 05:42:58.302] INFO: 开始获取积分历史:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "requestUserId": "677426b8bf3ce254abeac7f4"
  }
}
[2025-01-05 05:42:58.304] INFO: 积分历史查询结果:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "userId": "677426b8bf3ce254abeac7f4",
    "recordCount": 40,
    "records": [
      {
        "_id": "6779ea7ad22eadb0858e8cbf",
        "user": "677426b8bf3ce254abeac7f4",
        "points": 100,
        "type": "admin_grant",
        "operation": "add",
        "description": "管理员调整积分: 增加 100 积分",
        "balance": 1322,
        "createdAt": "2025-01-05T02:12:10.456Z",
        "updatedAt": "2025-01-05T02:12:10.456Z",
        "__v": 0
      },
      {
        "_id": "67794241d3a0b352f6fb3782",
        "user": "677426b8bf3ce254abeac7f4",
        "points": -3,
        "type": "use_assistant",
        "description": "使用AI助手: 美团全能客服",
        "balance": 1222,
        "metadata": {
          "assistantId": "6778c3a4ecc53bfd8c458163",
          "assistantName": "美团全能客服"
        },
        "createdAt": "2025-01-04T14:14:25.077Z",
        "updatedAt": "2025-01-04T14:14:25.077Z",
        "__v": 0
      }
    ]
  }
}
[2025-01-05 05:45:05.816] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 05:45:16.759] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
[2025-01-05 05:46:22.441] WARN: 认证失败: 无效的token
Details: {
  "metadata": {
    "service": "ai-assistant-api"
  }
}
2025-01-05 05:46:51 [INFO] 数据库连接成功
2025-01-05 05:46:51 [INFO] MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
2025-01-05 05:46:51 [INFO] 服务器已启动，监听端口 3000
2025-01-05 05:46:51 [INFO] 环境: development
2025-01-05 05:46:51 [INFO] API版本: 1.0.0
2025-01-05 05:46:58 [WARN] 认证失败: 无效的token
2025-01-05 05:47:11 [INFO] 用户尝试登录:
2025-01-05 05:47:11 [WARN] 登录失败: 密码错误
2025-01-05 05:47:47 [INFO] 用户尝试登录:
2025-01-05 05:47:47 [INFO] 用户登录成功
2025-01-05 05:48:02 [WARN] 认证失败: 无效的token
2025-01-05 05:48:19 [WARN] 认证失败: 无效的token
2025-01-05 05:48:30 [WARN] 认证失败: 无效的token
2025-01-05 05:48:51 [INFO] 数据库连接成功
2025-01-05 05:48:51 [INFO] MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
2025-01-05 05:48:51 [INFO] 服务器已启动，监听端口 3000
2025-01-05 05:48:51 [INFO] 环境: development
2025-01-05 05:48:51 [INFO] API版本: 1.0.0
2025-01-05 05:48:59 [WARN] 认证失败: 无效的token
2025-01-05 05:49:36 [INFO] 用户尝试登录:
2025-01-05 05:49:36 [INFO] 用户登录成功
2025-01-05 05:49:47 [WARN] 认证失败: 无效的token
2025-01-05 05:50:04 [INFO] 用户尝试登录:
2025-01-05 05:50:04 [INFO] 用户登录成功
2025-01-05 05:50:15 [INFO] 开始获取用户积分历史:
2025-01-05 05:50:15 [INFO] 获取积分历史成功:
2025-01-05 05:51:11 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 05:51:11 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 05:51:47 [INFO] 开始获取用户积分历史:
2025-01-05 05:51:47 [INFO] 获取积分历史成功:
2025-01-05 05:54:12 [INFO] 数据库连接成功
2025-01-05 05:54:12 [INFO] MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
2025-01-05 05:54:12 [INFO] 服务器已启动，监听端口 3000
2025-01-05 05:54:12 [INFO] 环境: development
2025-01-05 05:54:12 [INFO] API版本: 1.0.0
2025-01-05 05:54:24 [INFO] 开始调用Coze API:
2025-01-05 05:54:37 [INFO] Coze API调用成功:
2025-01-05 06:00:00 [INFO] 数据库连接成功
2025-01-05 06:00:00 [INFO] MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
2025-01-05 06:00:00 [INFO] 服务器已启动，监听端口 3000
2025-01-05 06:00:00 [INFO] 环境: development
2025-01-05 06:00:00 [INFO] API版本: 1.0.0
2025-01-05 06:05:04 [INFO] 用户尝试登录:
2025-01-05 06:05:05 [INFO] 用户登录成功
2025-01-05 06:05:13 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:05:13 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:07:15 [INFO] 开始获取积分历史:
2025-01-05 06:07:15 [INFO] 积分历史查询结果:
2025-01-05 06:07:45 [INFO] 开始获取积分历史:
2025-01-05 06:07:45 [INFO] 积分历史查询结果:
2025-01-05 06:07:51 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:07:51 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:07:51 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:07:51 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:07:54 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:07:54 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:07:54 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:07:54 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:07:56 [INFO] 开始获取积分历史:
2025-01-05 06:07:56 [INFO] 积分历史查询结果:
2025-01-05 06:15:03 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:15:03 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:15:18 [INFO] 开始获取积分历史:
2025-01-05 06:15:18 [INFO] 积分历史查询结果:
2025-01-05 06:15:26 [INFO] 开始获取积分历史:
2025-01-05 06:15:26 [INFO] 积分历史查询结果:
2025-01-05 06:15:31 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:15:31 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:15:31 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:15:31 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:15:34 [INFO] 开始获取积分历史:
2025-01-05 06:15:34 [INFO] 积分历史查询结果:
2025-01-05 06:15:54 [INFO] 开始获取积分历史:
2025-01-05 06:15:54 [INFO] 积分历史查询结果:
2025-01-05 06:15:58 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:15:58 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:15:58 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:15:58 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:16:00 [INFO] 开始获取积分历史:
2025-01-05 06:16:00 [INFO] 积分历史查询结果:
2025-01-05 06:16:06 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:16:06 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:17:52 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:17:52 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:17:52 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:17:52 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:17:52 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:17:52 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:17:52 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:17:52 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:18:13 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:18:13 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:18:13 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:18:13 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:18:13 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:18:13 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:18:14 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:18:14 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:18:32 [INFO] 开始获取积分历史:
2025-01-05 06:18:32 [INFO] 积分历史查询结果:
2025-01-05 06:19:25 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:19:25 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:19:25 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:19:25 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:19:25 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:19:25 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:19:25 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:19:25 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:23:14 [INFO] 开始获取积分历史:
2025-01-05 06:23:14 [INFO] 积分历史查询结果:
2025-01-05 06:23:20 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:23:20 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:23:20 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:23:20 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:23:22 [INFO] 开始获取积分历史:
2025-01-05 06:23:22 [INFO] 积分历史查询结果:
2025-01-05 06:23:24 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:23:24 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:23:25 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:23:25 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:23:25 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:23:25 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:23:41 [INFO] 开始获取积分历史:
2025-01-05 06:23:41 [INFO] 积分历史查询结果:
2025-01-05 06:23:47 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:23:47 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:23:47 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:23:47 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:23:50 [INFO] 开始获取积分历史:
2025-01-05 06:23:50 [INFO] 积分历史查询结果:
2025-01-05 06:25:05 [INFO] 用户尝试登录:
2025-01-05 06:25:05 [INFO] 用户登录成功
2025-01-05 06:25:14 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:25:14 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:25:38 [INFO] 开始获取积分历史:
2025-01-05 06:25:38 [INFO] 积分历史查询结果:
2025-01-05 06:25:53 [INFO] 开始获取积分历史:
2025-01-05 06:25:53 [INFO] 积分历史查询结果:
2025-01-05 06:25:57 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:25:57 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:25:58 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:25:58 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:25:59 [INFO] 开始获取积分历史:
2025-01-05 06:25:59 [INFO] 积分历史查询结果:
2025-01-05 06:27:32 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:27:32 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:41:13 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:41:13 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:41:13 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:41:13 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:41:13 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:41:13 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:41:43 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:41:43 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:41:43 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:41:43 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:41:43 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:41:43 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:43:16 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:43:16 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:43:16 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:43:16 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:43:16 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:43:16 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:47:48 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:47:48 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:47:49 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:47:49 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:47:49 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:47:49 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:48:18 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:48:18 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:48:18 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:48:18 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:48:22 [INFO] 用户尝试登录:
2025-01-05 06:48:22 [INFO] 用户登录成功
2025-01-05 06:48:22 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:48:22 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:48:22 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:48:22 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:48:24 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:48:24 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:48:48 [INFO] 开始获取积分历史:
2025-01-05 06:48:48 [INFO] 积分历史查询结果:
2025-01-05 06:49:02 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:49:02 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:49:02 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:49:02 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:49:10 [INFO] 开始更新AI助手
  Data: {"id":"6778c3a4ecc53bfd8c458163","name":"美团全能客服","type":"general","action":"update"}
2025-01-05 06:49:10 [INFO] AI助手更新成功
  Data: {"id":"6778c3a4ecc53bfd8c458163","name":"美团全能客服","type":"general","action":"update"}
2025-01-05 06:49:10 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:49:10 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:49:10 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:49:10 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:49:13 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:49:13 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:49:13 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:49:13 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:49:14 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:49:14 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:49:20 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:49:20 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:49:20 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:49:20 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:49:25 [INFO] 开始获取积分历史:
2025-01-05 06:49:25 [INFO] 积分历史查询结果:
2025-01-05 06:50:27 [INFO] 用户尝试登录:
2025-01-05 06:50:27 [INFO] 用户登录成功
2025-01-05 06:50:57 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:50:57 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:52:45 [INFO] 开始获取积分历史:
2025-01-05 06:52:45 [INFO] 积分历史查询结果:
2025-01-05 06:52:50 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:52:50 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:52:50 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:52:50 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:52:52 [INFO] 开始获取积分历史:
2025-01-05 06:52:52 [INFO] 积分历史查询结果:
2025-01-05 06:52:55 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:52:55 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:53:40 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:53:40 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:53:40 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:53:40 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:55:35 [INFO] 用户尝试登录:
2025-01-05 06:55:35 [INFO] 用户登录成功
2025-01-05 06:57:14 [INFO] 数据库连接成功
2025-01-05 06:57:14 [INFO] MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
2025-01-05 06:57:14 [INFO] 服务器已启动，监听端口 3000
2025-01-05 06:57:14 [INFO] 环境: production
2025-01-05 06:57:14 [INFO] API版本: 1.0.0
2025-01-05 06:57:18 [INFO] 用户尝试登录:
2025-01-05 06:57:18 [INFO] 用户登录成功
2025-01-05 06:58:08 [INFO] 开始获取积分历史:
2025-01-05 06:58:08 [INFO] 积分历史查询结果:
2025-01-05 06:58:31 [INFO] 开始获取积分历史:
2025-01-05 06:58:31 [INFO] 积分历史查询结果:
2025-01-05 06:58:34 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:58:34 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:58:34 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:58:34 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:58:36 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 06:58:36 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 06:59:59 [INFO] 开始获取积分历史:
2025-01-05 06:59:59 [INFO] 积分历史查询结果:
2025-01-05 07:00:23 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:00:23 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:00:23 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:00:23 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:00:26 [INFO] 开始获取积分历史:
2025-01-05 07:00:26 [INFO] 积分历史查询结果:
2025-01-05 07:09:02 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:09:02 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:09:02 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:09:02 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:09:09 [INFO] 用户尝试登录:
2025-01-05 07:09:10 [INFO] 用户登录成功
2025-01-05 07:09:10 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:09:10 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:09:10 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:09:10 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:09:13 [INFO] 开始获取积分历史:
2025-01-05 07:09:13 [INFO] 积分历史查询结果:
2025-01-05 07:09:16 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:09:16 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:09:26 [INFO] 开始获取积分历史:
2025-01-05 07:09:26 [INFO] 积分历史查询结果:
2025-01-05 07:09:33 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:09:33 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:09:33 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:09:33 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:09:35 [INFO] 开始获取积分历史:
2025-01-05 07:09:35 [INFO] 积分历史查询结果:
2025-01-05 07:09:39 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:09:39 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:09:39 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:09:39 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:19:38 [INFO] 用户尝试登录:
2025-01-05 07:19:38 [INFO] 用户登录成功
2025-01-05 07:25:31 [INFO] 数据库连接成功
2025-01-05 07:25:31 [INFO] MongoDB Connected: mongodb-yujin-mongodb.ns-65o8s9cp.svc:27017
2025-01-05 07:25:31 [INFO] 服务器已启动，监听端口 3000
2025-01-05 07:25:31 [INFO] 环境: development
2025-01-05 07:25:31 [INFO] API版本: 1.0.0
2025-01-05 07:26:05 [INFO] 开始获取积分历史:
2025-01-05 07:26:05 [INFO] 积分历史查询结果:
2025-01-05 07:26:30 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:26:30 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:26:30 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:26:30 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:26:32 [INFO] 开始获取积分历史:
2025-01-05 07:26:32 [INFO] 积分历史查询结果:
2025-01-05 07:26:42 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:26:42 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:26:42 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:26:42 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:26:44 [INFO] 开始获取积分历史:
2025-01-05 07:26:44 [INFO] 积分历史查询结果:
2025-01-05 07:36:00 [INFO] 开始获取积分历史:
2025-01-05 07:36:00 [INFO] 积分历史查询结果:
2025-01-05 07:36:08 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:36:08 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:36:29 [INFO] 开始获取积分历史:
2025-01-05 07:36:29 [INFO] 积分历史查询结果:
2025-01-05 07:36:36 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:36:36 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:36:36 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:36:36 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:36:39 [INFO] 开始获取积分历史:
2025-01-05 07:36:39 [INFO] 积分历史查询结果:
2025-01-05 07:40:16 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:40:16 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:40:16 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:40:16 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:40:23 [INFO] 开始获取积分历史:
2025-01-05 07:40:23 [INFO] 积分历史查询结果:
2025-01-05 07:41:40 [INFO] 开始获取积分历史:
2025-01-05 07:41:40 [INFO] 积分历史查询结果:
2025-01-05 07:41:43 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:41:43 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:41:43 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:41:43 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:41:45 [INFO] 开始获取积分历史:
2025-01-05 07:41:45 [INFO] 积分历史查询结果:
2025-01-05 07:42:02 [INFO] 开始获取积分历史:
2025-01-05 07:42:02 [INFO] 积分历史查询结果:
2025-01-05 07:42:06 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:42:06 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:42:07 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:42:07 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:42:09 [INFO] 开始获取积分历史:
2025-01-05 07:42:09 [INFO] 积分历史查询结果:
2025-01-05 07:42:37 [INFO] 开始获取积分历史:
2025-01-05 07:42:37 [INFO] 积分历史查询结果:
2025-01-05 07:42:40 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:42:40 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:42:40 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:42:40 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:42:41 [INFO] 开始获取积分历史:
2025-01-05 07:42:41 [INFO] 积分历史查询结果:
2025-01-05 07:44:12 [INFO] 开始获取积分历史:
2025-01-05 07:44:12 [INFO] 积分历史查询结果:
2025-01-05 07:44:47 [INFO] 开始获取积分历史:
2025-01-05 07:44:47 [INFO] 积分历史查询结果:
2025-01-05 07:44:50 [INFO] 开始获取积分历史:
2025-01-05 07:44:50 [INFO] 积分历史查询结果:
2025-01-05 07:44:52 [INFO] 开始获取积分历史:
2025-01-05 07:44:52 [INFO] 积分历史查询结果:
2025-01-05 07:45:01 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:45:01 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:45:01 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:45:01 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:45:01 [INFO] 开始获取积分历史:
2025-01-05 07:45:01 [INFO] 积分历史查询结果:
2025-01-05 07:45:07 [INFO] 开始获取积分历史:
2025-01-05 07:45:07 [INFO] 积分历史查询结果:
2025-01-05 07:45:42 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:45:42 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:45:42 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:45:42 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:45:43 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:45:43 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:45:53 [INFO] 开始获取积分历史:
2025-01-05 07:45:53 [INFO] 积分历史查询结果:
2025-01-05 07:46:00 [INFO] 开始获取积分历史:
2025-01-05 07:46:00 [INFO] 积分历史查询结果:
2025-01-05 07:48:02 [INFO] 开始获取积分历史:
2025-01-05 07:48:02 [INFO] 积分历史查询结果:
2025-01-05 07:48:05 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:48:05 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:48:05 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:48:05 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:48:06 [INFO] 开始获取积分历史:
2025-01-05 07:48:06 [INFO] 积分历史查询结果:
2025-01-05 07:48:13 [INFO] 开始获取积分历史:
2025-01-05 07:48:13 [INFO] 积分历史查询结果:
2025-01-05 07:50:24 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:50:24 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:50:24 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:50:24 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:50:29 [INFO] 用户尝试登录:
2025-01-05 07:50:29 [INFO] 用户登录成功
2025-01-05 07:50:29 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:50:29 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:50:29 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:50:29 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:50:38 [INFO] 开始获取积分历史:
2025-01-05 07:50:38 [INFO] 积分历史查询结果:
2025-01-05 07:50:44 [INFO] 开始获取积分历史:
2025-01-05 07:50:44 [INFO] 积分历史查询结果:
2025-01-05 07:52:26 [INFO] 开始获取积分历史:
2025-01-05 07:52:26 [INFO] 积分历史查询结果:
2025-01-05 07:52:31 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:52:31 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:52:31 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:52:31 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}
2025-01-05 07:52:32 [INFO] 获取AI助手列表
  Data: {"action":"list"}
2025-01-05 07:52:32 [INFO] 获取AI助手列表成功
  Data: {"action":"list"}

2024-12-31 17:15:54 [ERROR]: 令牌验证失败: invalid signature
2024-12-31 17:25:28 [ERROR]: 开发环境错误: 找不到路径: /api
Error: 找不到路径: /api
    at notFound (/home/devbox/project/src/middleware/error.middleware.js:134:19)
    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/devbox/project/node_modules/express/lib/router/index.js:328:13)
    at /home/devbox/project/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/devbox/project/node_modules/express/lib/router/index.js:346:12)
    at next (/home/devbox/project/node_modules/express/lib/router/index.js:280:10)
    at /home/devbox/project/src/middleware/auth.middleware.js:158:9
    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/devbox/project/node_modules/express/lib/router/index.js:328:13)
    at /home/devbox/project/node_modules/express/lib/router/index.js:286:9
2024-12-31 17:25:37 [ERROR]: 用户注册失败: Cannot read properties of undefined (reading 'error')
TypeError: Cannot read properties of undefined (reading 'error')
    at exports.register (/home/devbox/project/src/controllers/user.controller.js:12:53)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2024-12-31 17:37:35 [ERROR]: 令牌验证失败: invalid signature
2024-12-31 17:38:38 [ERROR]: 令牌验证失败: invalid signature
2024-12-31 17:41:18 [ERROR]: 创建AI助手失败: AIAssistant validation failed: type: `general` is not a valid enum value for path `type`.
ValidationError: AIAssistant validation failed: type: `general` is not a valid enum value for path `type`.
    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)
    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17
    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9
    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)
{"kind":"ObjectId","level":"error","message":"调用AI助手失败: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOne (/home/devbox/project/node_modules/mongoose/lib/query.js:2533:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:144:27)","stringValue":"\"general-service\"","timestamp":"2025-01-03 05:11:40","value":"general-service","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"undefined\"","timestamp":"2025-01-03 10:49:12","value":"undefined","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"undefined\"","timestamp":"2025-01-03 10:52:35","value":"undefined","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"undefined\"","timestamp":"2025-01-03 10:54:33","value":"undefined","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"undefined\"","timestamp":"2025-01-03 10:54:43","value":"undefined","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"general-service\"","timestamp":"2025-01-03 10:57:11","value":"general-service","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"general-service\"","timestamp":"2025-01-03 10:57:26","value":"general-service","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"general-service\"","timestamp":"2025-01-03 10:57:36","value":"general-service","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"general-service\"","timestamp":"2025-01-03 10:59:47","value":"general-service","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"general-service\"","timestamp":"2025-01-03 11:03:01","value":"general-service","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"general-service\"","timestamp":"2025-01-03 11:03:12","value":"general-service","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"general-service\"","timestamp":"2025-01-03 11:05:08","value":"general-service","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"general-service\"","timestamp":"2025-01-03 11:06:33","value":"general-service","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"更新AI助手失败: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"","path":"_id","reason":{},"stack":"CastError: Cast to ObjectId failed for value \"general-service\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at ObjectId.cast (/home/devbox/project/node_modules/mongoose/lib/schema/objectid.js:250:11)\n    at SchemaType.applySetters (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1219:12)\n    at SchemaType.castForQuery (/home/devbox/project/node_modules/mongoose/lib/schematype.js:1633:15)\n    at cast (/home/devbox/project/node_modules/mongoose/lib/cast.js:389:32)\n    at Query.cast (/home/devbox/project/node_modules/mongoose/lib/query.js:4927:12)\n    at Query._castConditions (/home/devbox/project/node_modules/mongoose/lib/query.js:2237:10)\n    at model.Query._findOneAndUpdate (/home/devbox/project/node_modules/mongoose/lib/query.js:3319:8)\n    at model.Query.exec (/home/devbox/project/node_modules/mongoose/lib/query.js:4447:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:27)","stringValue":"\"general-service\"","timestamp":"2025-01-03 11:06:51","value":"general-service","valueType":"string"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:148:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-03 13:25:08"}
{"level":"error","message":"调用AI助手失败: Deepseek API暂未实现","stack":"Error: Deepseek API暂未实现\n    at exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:219:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-03 16:10:32"}
{"level":"error","message":"调用AI助手失败: Deepseek API暂未实现","stack":"Error: Deepseek API暂未实现\n    at exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:219:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-03 16:10:54"}
{"level":"error","message":"调用AI助手失败: Deepseek API暂未实现","stack":"Error: Deepseek API暂未实现\n    at exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:219:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-03 16:18:24"}
{"_message":"AIAssistant validation failed","errors":{"config.botId":{"kind":"required","message":"Path `config.botId` is required.","name":"ValidatorError","path":"config.botId","properties":{"message":"Path `config.botId` is required.","path":"config.botId","type":"required"}}},"level":"error","message":"更新AI助手失败: AIAssistant validation failed: config.botId: Path `config.botId` is required.","stack":"ValidationError: AIAssistant validation failed: config.botId: Path `config.botId` is required.\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-03 16:20:13"}
{"_message":"AIAssistant validation failed","errors":{"config.botId":{"kind":"required","message":"Path `config.botId` is required.","name":"ValidatorError","path":"config.botId","properties":{"message":"Path `config.botId` is required.","path":"config.botId","type":"required"}}},"level":"error","message":"更新AI助手失败: AIAssistant validation failed: config.botId: Path `config.botId` is required.","stack":"ValidationError: AIAssistant validation failed: config.botId: Path `config.botId` is required.\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-03 16:21:11"}
{"config":{"apiKey":"***","apiUrl":"https://api.coze.cn/open_api/v2/chat","botId":"7436564709694521371 ","maxTokens":2500,"modelType":"coze","temperature":0.6},"error":"API调用失败：Requested resource bot_id=7436564709694521371  does not exist. Ensure you are the correct resource identifier.","level":"error","message":"Coze API调用失败:","stack":"Error: API调用失败：Requested resource bot_id=7436564709694521371  does not exist. Ensure you are the correct resource identifier.\n    at CozeService.chat (/home/devbox/project/server/services/cozeService.js:168:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:204:32)","timestamp":"2025-01-03 17:08:47"}
{"level":"error","message":"调用AI助手失败: 请求错误：API调用失败：Requested resource bot_id=7436564709694521371  does not exist. Ensure you are the correct resource identifier.","stack":"Error: 请求错误：API调用失败：Requested resource bot_id=7436564709694521371  does not exist. Ensure you are the correct resource identifier.\n    at exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:206:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-03 17:08:47"}
{"config":{"apiKey":"***","apiUrl":"https://api.coze.cn/open_api/v2/chat","botId":"7436564709694521371","maxTokens":2500,"modelType":"coze","temperature":0.6},"error":"timeout of 30000ms exceeded","level":"error","message":"Coze API调用失败:","stack":"AxiosError: timeout of 30000ms exceeded\n    at RedirectableRequest.handleRequestTimeout (/home/devbox/project/node_modules/axios/dist/node/axios.cjs:3200:16)\n    at RedirectableRequest.emit (node:events:518:28)\n    at Timeout.<anonymous> (/home/devbox/project/node_modules/follow-redirects/index.js:221:12)\n    at listOnTimeout (node:internal/timers:594:17)\n    at process.processTimers (node:internal/timers:529:7)\n    at Axios.request (/home/devbox/project/node_modules/axios/dist/node/axios.cjs:4252:41)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:136:30)\n    at async exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:204:32)","timestamp":"2025-01-03 17:10:33"}
{"level":"error","message":"调用AI助手失败: 无法连接到API服务器，请检查网络连接","stack":"Error: 无法连接到API服务器，请检查网络连接\n    at exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:206:27)","timestamp":"2025-01-03 17:10:33"}
{"_message":"AIAssistant validation failed","errors":{"key":{"kind":"required","message":"AI助手标识符是必需的","name":"ValidatorError","path":"key","properties":{"message":"AI助手标识符是必需的","path":"key","type":"required"}}},"level":"error","message":"创建AI助手失败: AIAssistant validation failed: key: AI助手标识符是必需的","stack":"ValidationError: AIAssistant validation failed: key: AI助手标识符是必需的\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-03 17:25:43"}
{"_message":"AIAssistant validation failed","errors":{"key":{"kind":"required","message":"AI助手标识符是必需的","name":"ValidatorError","path":"key","properties":{"message":"AI助手标识符是必需的","path":"key","type":"required"}}},"level":"error","message":"创建AI助手失败: AIAssistant validation failed: key: AI助手标识符是必需的","stack":"ValidationError: AIAssistant validation failed: key: AI助手标识符是必需的\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-03 17:26:09"}
{"_message":"AIAssistant validation failed","errors":{"key":{"kind":"required","message":"AI助手标识符是必需的","name":"ValidatorError","path":"key","properties":{"message":"AI助手标识符是必需的","path":"key","type":"required"}}},"level":"error","message":"创建AI助手失败: AIAssistant validation failed: key: AI助手标识符是必需的","stack":"ValidationError: AIAssistant validation failed: key: AI助手标识符是必需的\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-03 17:26:23"}
{"_message":"AIAssistant validation failed","errors":{"config.modelType":{"kind":"required","message":"大模型类型是必需的","name":"ValidatorError","path":"config.modelType","properties":{"fullPath":"config.modelType","message":"大模型类型是必需的","path":"config.modelType","type":"required"}}},"level":"error","message":"创建AI助手失败: AIAssistant validation failed: config.modelType: 大模型类型是必需的","stack":"ValidationError: AIAssistant validation failed: config.modelType: 大模型类型是必需的\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-03 17:33:47"}
{"level":"error","message":"创建AI助手失败: key字段不可修改","stack":"Error: key字段不可修改\n    at model.<anonymous> (/home/devbox/project/server/models/aiAssistant.model.js:133:14)\n    at callMiddlewareFunction (/home/devbox/project/node_modules/kareem/index.js:628:27)\n    at model.next (/home/devbox/project/node_modules/kareem/index.js:93:7)\n    at _next (/home/devbox/project/node_modules/kareem/index.js:146:10)\n    at /home/devbox/project/node_modules/kareem/index.js:653:30\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-03 17:40:54"}
{"_message":"AIAssistant validation failed","errors":{"key":{"kind":"required","message":"AI助手标识符是必需的","name":"ValidatorError","path":"key","properties":{"message":"AI助手标识符是必需的","path":"key","type":"required"}}},"level":"error","message":"创建AI助手失败: AIAssistant validation failed: key: AI助手标识符是必需的","stack":"ValidationError: AIAssistant validation failed: key: AI助手标识符是必需的\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-03 17:42:33"}
{"_message":"AIAssistant validation failed","errors":{"key":{"kind":"required","message":"AI助手标识符是必需的","name":"ValidatorError","path":"key","properties":{"message":"AI助手标识符是必需的","path":"key","type":"required"}}},"level":"error","message":"创建AI助手失败: AIAssistant validation failed: key: AI助手标识符是必需的","stack":"ValidationError: AIAssistant validation failed: key: AI助手标识符是必需的\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-03 17:44:08"}
{"level":"error","message":"创建AI助手失败: key字段不可修改","stack":"Error: key字段不可修改\n    at model.<anonymous> (/home/devbox/project/server/models/aiAssistant.model.js:133:14)\n    at callMiddlewareFunction (/home/devbox/project/node_modules/kareem/index.js:628:27)\n    at model.next (/home/devbox/project/node_modules/kareem/index.js:93:7)\n    at _next (/home/devbox/project/node_modules/kareem/index.js:146:10)\n    at /home/devbox/project/node_modules/kareem/index.js:653:30\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-03 17:47:54"}
{"level":"error","message":"创建AI助手失败: ApiResponse.created is not a function","stack":"TypeError: ApiResponse.created is not a function\n    at exports.createAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:51:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-03 17:49:05"}
{"code":11000,"index":0,"keyPattern":{"name":1},"keyValue":{"name":"外卖店铺诊断专家"},"level":"error","message":"创建AI助手失败: E11000 duplicate key error collection: ai_assistant_platform.aiassistants index: name_1 dup key: { name: \"外卖店铺诊断专家\" }","stack":"MongoServerError: E11000 duplicate key error collection: ai_assistant_platform.aiassistants index: name_1 dup key: { name: \"外卖店铺诊断专家\" }\n    at /home/devbox/project/node_modules/mongodb/lib/operations/insert.js:50:33\n    at /home/devbox/project/node_modules/mongodb/lib/operations/command.js:84:64\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-03 17:51:06"}
{"level":"error","message":"删除AI助手失败: ApiResponse.deleted is not a function","stack":"TypeError: ApiResponse.deleted is not a function\n    at exports.deleteAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:162:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-03 17:53:54"}
{"_message":"AIAssistant validation failed","errors":{"config.model":{"kind":"required","message":"模型配置是必需的","name":"ValidatorError","path":"config.model","properties":{"message":"模型配置是必需的","path":"config.model","type":"required"}}},"level":"error","message":"AI服务调用失败: AIAssistant validation failed: config.model: 模型配置是必需的","stack":"ValidationError: AIAssistant validation failed: config.model: 模型配置是必需的\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-04 01:25:20"}
{"_message":"AIAssistant validation failed","errors":{"config.model":{"kind":"required","message":"模型配置是必需的","name":"ValidatorError","path":"config.model","properties":{"message":"模型配置是必需的","path":"config.model","type":"required"}}},"level":"error","message":"调用AI助手失败: AIAssistant validation failed: config.model: 模型配置是必需的","stack":"ValidationError: AIAssistant validation failed: config.model: 模型配置是必需的\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-04 01:25:20"}
{"_message":"Validation failed","errors":{"config.model":{"kind":"required","message":"模型配置是必需的","name":"ValidatorError","path":"config.model","properties":{"fullPath":"config.model","message":"模型配置是必需的","path":"config.model","type":"required"}}},"level":"error","message":"更新AI助手失败: Validation failed: config.model: 模型配置是必需的","stack":"ValidationError: Validation failed: config.model: 模型配置是必需的\n    at _done (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:228:19)\n    at /home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:204:11\n    at schemaPath.doValidate.updateValidator (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:162:13)\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1360:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-04 01:48:57"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 01:51:27"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 01:53:10"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 01:54:39"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 01:55:59"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 01:56:49"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 01:58:04"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 02:00:05"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 02:01:38"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 02:02:40"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 02:04:30"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 02:06:18"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 02:17:10"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 02:21:57"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 02:23:55"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 02:26:22"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 02:29:00"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:111:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 02:31:48"}
{"_message":"Validation failed","errors":{"config.model":{"kind":"required","message":"模型配置是必需的","name":"ValidatorError","path":"config.model","properties":{"fullPath":"config.model","message":"模型配置是必需的","path":"config.model","type":"required"}}},"level":"error","message":"更新AI助手失败: Validation failed: config.model: 模型配置是必需的","stack":"ValidationError: Validation failed: config.model: 模型配置是必需的\n    at _done (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:228:19)\n    at /home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:204:11\n    at schemaPath.doValidate.updateValidator (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:162:13)\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1360:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-04 03:09:49"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:12:01"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:16:33"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:18:00"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:19:34"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:21:01"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:22:33"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:24:16"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:26:46"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:28:36"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:28:40"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:32:50"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:36:43"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:38:49"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:40:11"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:41:43"}
{"_message":"Validation failed","errors":{"config.model":{"kind":"required","message":"模型配置是必需的","name":"ValidatorError","path":"config.model","properties":{"fullPath":"config.model","message":"模型配置是必需的","path":"config.model","type":"required"}}},"level":"error","message":"更新AI助手失败: Validation failed: config.model: 模型配置是必需的","stack":"ValidationError: Validation failed: config.model: 模型配置是必需的\n    at _done (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:228:19)\n    at /home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:204:11\n    at schemaPath.doValidate.updateValidator (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:162:13)\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1360:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-04 03:57:36"}
{"level":"error","message":"删除AI助手失败: ApiResponse.deleted is not a function","stack":"TypeError: ApiResponse.deleted is not a function\n    at exports.deleteAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:127:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 03:58:01"}
{"level":"error","message":"创建AI助手失败: ApiResponse.created is not a function","stack":"TypeError: ApiResponse.created is not a function\n    at exports.createAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:45:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 04:00:11"}
{"level":"error","message":"更新AI助手失败: ApiResponse.updated is not a function","stack":"TypeError: ApiResponse.updated is not a function\n    at exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:113:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 04:00:23"}
{"level":"error","message":"删除AI助手失败: ApiResponse.deleted is not a function","stack":"TypeError: ApiResponse.deleted is not a function\n    at exports.deleteAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:127:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 04:00:33"}
{"code":11000,"index":0,"keyPattern":{"name":1},"keyValue":{"name":"测试助手"},"level":"error","message":"创建AI助手失败: E11000 duplicate key error collection: ai_assistant_platform.aiassistants index: name_1 dup key: { name: \"测试助手\" }","stack":"MongoServerError: E11000 duplicate key error collection: ai_assistant_platform.aiassistants index: name_1 dup key: { name: \"测试助手\" }\n    at /home/devbox/project/node_modules/mongodb/lib/operations/insert.js:50:33\n    at /home/devbox/project/node_modules/mongodb/lib/operations/command.js:84:64\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 04:01:52"}
{"level":"error","message":"创建AI助手失败: ApiResponse.created is not a function","stack":"TypeError: ApiResponse.created is not a function\n    at exports.createAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:45:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 04:03:47"}
{"level":"error","message":"创建AI助手失败: ApiResponse.created is not a function","stack":"TypeError: ApiResponse.created is not a function\n    at exports.createAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:45:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 04:04:26"}
{"level":"error","message":"删除AI助手失败: ApiResponse.deleted is not a function","stack":"TypeError: ApiResponse.deleted is not a function\n    at exports.deleteAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:127:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 04:05:14"}
{"_message":"Validation failed","errors":{"config.model":{"kind":"required","message":"模型配置是必需的","name":"ValidatorError","path":"config.model","properties":{"fullPath":"config.model","message":"模型配置是必需的","path":"config.model","type":"required"}}},"level":"error","message":"更新AI助手失败: Validation failed: config.model: 模型配置是必需的","stack":"ValidationError: Validation failed: config.model: 模型配置是必需的\n    at _done (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:228:19)\n    at /home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:204:11\n    at schemaPath.doValidate.updateValidator (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:162:13)\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1360:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-04 04:05:40"}
{"_message":"Validation failed","errors":{"config.model":{"kind":"required","message":"模型配置是必需的","name":"ValidatorError","path":"config.model","properties":{"fullPath":"config.model","message":"模型配置是必需的","path":"config.model","type":"required"}}},"level":"error","message":"更新AI助手失败: Validation failed: config.model: 模型配置是必需的","stack":"ValidationError: Validation failed: config.model: 模型配置是必需的\n    at _done (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:228:19)\n    at /home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:204:11\n    at schemaPath.doValidate.updateValidator (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:162:13)\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1360:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-04 04:08:20"}
{"level":"error","message":"删除AI助手失败: ApiResponse.deleted is not a function","stack":"TypeError: ApiResponse.deleted is not a function\n    at exports.deleteAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:127:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 04:08:47"}
{"level":"error","message":"删除AI助手失败: ApiResponse.deleted is not a function","stack":"TypeError: ApiResponse.deleted is not a function\n    at exports.deleteAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:127:30)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 04:08:52"}
{"_message":"Validation failed","errors":{"config.model":{"kind":"required","message":"模型配置是必需的","name":"ValidatorError","path":"config.model","properties":{"fullPath":"config.model","message":"模型配置是必需的","path":"config.model","type":"required"}}},"level":"error","message":"更新AI助手失败: Validation failed: config.model: 模型配置是必需的","stack":"ValidationError: Validation failed: config.model: 模型配置是必需的\n    at _done (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:228:19)\n    at /home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:204:11\n    at schemaPath.doValidate.updateValidator (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:162:13)\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1360:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-04 04:09:11"}
{"_message":"Validation failed","errors":{"config.model":{"kind":"required","message":"模型配置是必需的","name":"ValidatorError","path":"config.model","properties":{"fullPath":"config.model","message":"模型配置是必需的","path":"config.model","type":"required"}}},"level":"error","message":"更新AI助手失败: Validation failed: config.model: 模型配置是必需的","stack":"ValidationError: Validation failed: config.model: 模型配置是必需的\n    at _done (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:228:19)\n    at /home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:204:11\n    at schemaPath.doValidate.updateValidator (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:162:13)\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1360:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-04 04:12:56"}
{"_message":"Validation failed","errors":{"key":{"kind":"required","message":"AI助手标识符是必需的","name":"ValidatorError","path":"key","properties":{"fullPath":"key","message":"AI助手标识符是必需的","path":"key","type":"required","value":""},"value":""}},"level":"error","message":"更新AI助手失败: Validation failed: key: AI助手标识符是必需的","stack":"ValidationError: Validation failed: key: AI助手标识符是必需的\n    at _done (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:228:19)\n    at /home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:204:11\n    at schemaPath.doValidate.updateValidator (/home/devbox/project/node_modules/mongoose/lib/helpers/updateValidators.js:162:13)\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1360:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-01-04 04:13:29"}
{"level":"error","message":"connect ECONNREFUSED ::1:27017, connect ECONNREFUSED 127.0.0.1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{},"setName":null,"stale":false,"type":"Unknown"},"stack":"MongooseServerSelectionError: connect ECONNREFUSED ::1:27017, connect ECONNREFUSED 127.0.0.1:27017\n    at _handleConnectionErrors (/home/devbox/project/node_modules/mongoose/lib/connection.js:816:11)\n    at NativeConnection.openUri (/home/devbox/project/node_modules/mongoose/lib/connection.js:791:11)","timestamp":"2025-01-04 04:24:12"}
{"body":{},"level":"error","message":"aiAssistantService.getAssistantStats is not a function","method":"GET","path":"/api/assistants/stats","stack":"TypeError: aiAssistantService.getAssistantStats is not a function\n    at exports.getAssistantStats (/home/devbox/project/server/controllers/aiAssistant.controller.js:70:48)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.auth (/home/devbox/project/server/middleware/auth.js:27:9)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 04:33:07","user":"677426b8bf3ce254abeac7f4"}
{"body":{},"level":"error","message":"aiAssistantService.getAssistantStats is not a function","method":"GET","path":"/api/assistants/stats","stack":"TypeError: aiAssistantService.getAssistantStats is not a function\n    at exports.getAssistantStats (/home/devbox/project/server/controllers/aiAssistant.controller.js:70:48)\n    at Layer.handle [as handle_request] (/home/devbox/project/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/devbox/project/node_modules/express/lib/router/route.js:149:13)\n    at exports.auth (/home/devbox/project/server/middleware/auth.js:27:9)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-01-04 04:33:07","user":"677426b8bf3ce254abeac7f4"}
[2025-01-04 04:41:39] [31MERROR[39M: 创建AI助手失败:
{
  "error": "AIAssistant validation failed: key: AI助手标识符是必需的",
  "name": "美团全能客服",
  "type": "general"
}
[2025-01-04 04:41:39] [31MERROR[39M: 创建AI助手失败: AIAssistant validation failed: key: AI助手标识符是必需的
{
  "stack": "ApiError: 创建AI助手失败: AIAssistant validation failed: key: AI助手标识符是必需的\n    at AiAssistantService.createAssistant (/home/devbox/project/server/services/aiAssistant.service.js:38:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.createAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:34:27)",
  "path": "/api/assistants",
  "method": "POST",
  "body": {
    "name": "美团全能客服",
    "description": "提供专业的客服话术和回复建议，帮助商家高效处理各类客户问题",
    "type": "general",
    "pointsCost": 3,
    "config": {
      "modelType": "coze",
      "apiKey": "pat_gMDZEOZoPKPPcr57dT2lNUGCFjqlkYo67GCcDtFTdYkrW92iXVlcLzVAeXgei92l",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "model": "coze-bot"
    },
    "isActive": true,
    "key": "",
    "metadata": {
      "version": "1.0.0",
      "tags": []
    },
    "accessLevel": "public"
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:44:22] [31MERROR[39M: 调用AI助手失败:
{
  "error": "不支持的AI助手类型",
  "assistantKey": "meituan-service",
  "userId": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:44:22] [31MERROR[39M: 调用AI助手失败: 不支持的AI助手类型
{
  "stack": "ApiError: 调用AI助手失败: 不支持的AI助手类型\n    at AiAssistantService.callAssistant (/home/devbox/project/server/services/aiAssistant.service.js:281:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:26)",
  "path": "/api/assistants/call",
  "method": "POST",
  "body": {
    "assistantKey": "meituan-service",
    "message": "你好，请问如何处理顾客的退款申请？"
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:45:14] [31MERROR[39M: 调用AI助手失败:
{
  "error": "不支持的AI助手类型",
  "assistantKey": "meituan-service",
  "userId": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:45:14] [31MERROR[39M: 调用AI助手失败: 不支持的AI助手类型
{
  "stack": "ApiError: 调用AI助手失败: 不支持的AI助手类型\n    at AiAssistantService.callAssistant (/home/devbox/project/server/services/aiAssistant.service.js:281:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:26)",
  "path": "/api/assistants/call",
  "method": "POST",
  "body": {
    "assistantKey": "meituan-service",
    "message": "你好，请问如何处理顾客的退款申请？"
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:45:46] [31MERROR[39M: 调用AI助手失败:
{
  "error": "不支持的AI助手类型",
  "assistantKey": "meituan-service",
  "userId": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:45:46] [31MERROR[39M: 调用AI助手失败: 不支持的AI助手类型
{
  "stack": "ApiError: 调用AI助手失败: 不支持的AI助手类型\n    at AiAssistantService.callAssistant (/home/devbox/project/server/services/aiAssistant.service.js:281:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:26)",
  "path": "/api/assistants/call",
  "method": "POST",
  "body": {
    "assistantKey": "meituan-service",
    "message": "你好，请问如何处理顾客的退款申请？"
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:46:25] [31MERROR[39M: 调用AI助手失败:
{
  "error": "不支持的AI助手类型",
  "assistantKey": "meituan-service",
  "userId": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:46:25] [31MERROR[39M: 调用AI助手失败: 不支持的AI助手类型
{
  "stack": "ApiError: 调用AI助手失败: 不支持的AI助手类型\n    at AiAssistantService.callAssistant (/home/devbox/project/server/services/aiAssistant.service.js:281:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:26)",
  "path": "/api/assistants/call",
  "method": "POST",
  "body": {
    "assistantKey": "meituan-service",
    "message": "你好，请问如何处理顾客的退款申请？"
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:47:06] [31MERROR[39M: 调用AI助手失败:
{
  "error": "不支持的AI助手类型",
  "assistantKey": "meituan-service",
  "userId": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:47:06] [31MERROR[39M: 调用AI助手失败: 不支持的AI助手类型
{
  "stack": "ApiError: 调用AI助手失败: 不支持的AI助手类型\n    at AiAssistantService.callAssistant (/home/devbox/project/server/services/aiAssistant.service.js:281:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:26)",
  "path": "/api/assistants/call",
  "method": "POST",
  "body": {
    "assistantKey": "meituan-service",
    "message": "你好，请问如何处理顾客的退款申请？"
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:49:23] [31MERROR[39M: 调用AI助手失败:
{
  "error": "不支持的AI助手类型",
  "assistantKey": "meituan-service",
  "userId": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:49:23] [31MERROR[39M: 调用AI助手失败: 不支持的AI助手类型
{
  "stack": "ApiError: 调用AI助手失败: 不支持的AI助手类型\n    at AiAssistantService.callAssistant (/home/devbox/project/server/services/aiAssistant.service.js:281:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:26)",
  "path": "/api/assistants/call",
  "method": "POST",
  "body": {
    "assistantKey": "meituan-service",
    "message": "你好，请问如何处理顾客的退款申请？"
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:49:54] [31MERROR[39M: 调用AI助手失败:
{
  "error": "不支持的AI助手类型",
  "assistantKey": "meituan-service",
  "userId": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 07:49:54] [31MERROR[39M: 调用AI助手失败: 不支持的AI助手类型
{
  "stack": "ApiError: 调用AI助手失败: 不支持的AI助手类型\n    at AiAssistantService.callAssistant (/home/devbox/project/server/services/aiAssistant.service.js:281:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:26)",
  "path": "/api/assistants/call",
  "method": "POST",
  "body": {
    "assistantKey": "meituan-service",
    "message": "你好，请问如何处理顾客的退款申请？"
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 08:14:20] [31MERROR[39M: 调用AI助手失败:
{
  "error": "不支持的AI助手类型",
  "assistantKey": "meituan-service",
  "userId": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 08:14:20] [31MERROR[39M: 调用AI助手失败: 不支持的AI助手类型
{
  "stack": "ApiError: 调用AI助手失败: 不支持的AI助手类型\n    at AiAssistantService.callAssistant (/home/devbox/project/server/services/aiAssistant.service.js:281:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.callAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:103:26)",
  "path": "/api/assistants/call",
  "method": "POST",
  "body": {
    "assistantKey": "meituan-service",
    "message": "你好，请问如何处理顾客的退款申请？"
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 08:57:41] [31MERROR[39M: PointsHistory validation failed: balance: Path `balance` is required., type: `use_assistant` is not a valid enum value for path `type`.
{
  "stack": "ValidationError: PointsHistory validation failed: balance: Path `balance` is required., type: `use_assistant` is not a valid enum value for path `type`.\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)",
  "path": "/api/assistants/meituan-service/chat",
  "method": "POST",
  "body": {
    "message": "你好，请介绍下你自己"
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 08:58:23] [31MERROR[39M: PointsHistory validation failed: balance: Path `balance` is required., type: `use_assistant` is not a valid enum value for path `type`.
{
  "stack": "ValidationError: PointsHistory validation failed: balance: Path `balance` is required., type: `use_assistant` is not a valid enum value for path `type`.\n    at Document.invalidate (/home/devbox/project/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/devbox/project/node_modules/mongoose/lib/document.js:3012:17\n    at /home/devbox/project/node_modules/mongoose/lib/schematype.js:1368:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)",
  "path": "/api/assistants/meituan-service/chat",
  "method": "POST",
  "body": {
    "message": "你好，请介绍下你自己"
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 10:04:00] [31MERROR[39M: 更新AI助手失败:
{
  "error": "Validation failed: config.apiUrl: API地址是必需的",
  "id": "6778c3a4ecc53bfd8c458163",
  "name": "美团全能客服"
}
[2025-01-04 10:04:00] [31MERROR[39M: 更新AI助手失败: Validation failed: config.apiUrl: API地址是必需的
{
  "stack": "ApiError: 更新AI助手失败: Validation failed: config.apiUrl: API地址是必需的\n    at AiAssistantService.updateAssistant (/home/devbox/project/server/services/aiAssistant.service.js:98:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:49:27)",
  "path": "/api/assistants/6778c3a4ecc53bfd8c458163",
  "method": "PUT",
  "body": {
    "name": "美团全能客服",
    "description": "提供专业的客服话术和回复建议，帮助商家高效处理各类客户问题",
    "type": "general",
    "pointsCost": 3,
    "isActive": true,
    "config": {
      "modelType": "coze",
      "apiKey": "pat_gMDZEOZoPKPPcr57dT2lNUGCFjqlkYo67GCcDtFTdYkrW92iXVlcLzVAeXgei92l",
      "temperature": 0.8,
      "maxTokens": 2000,
      "url": "https://api.coze.cn/open_api/v2/chat",
      "bot_id": "7450790638439907355",
      "model": "coze-bot"
    }
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 10:04:05] [31MERROR[39M: 更新AI助手失败:
{
  "error": "Validation failed: config.apiUrl: API地址是必需的",
  "id": "6778c3a4ecc53bfd8c458163",
  "name": "美团全能客服"
}
[2025-01-04 10:04:05] [31MERROR[39M: 更新AI助手失败: Validation failed: config.apiUrl: API地址是必需的
{
  "stack": "ApiError: 更新AI助手失败: Validation failed: config.apiUrl: API地址是必需的\n    at AiAssistantService.updateAssistant (/home/devbox/project/server/services/aiAssistant.service.js:98:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.updateAssistant (/home/devbox/project/server/controllers/aiAssistant.controller.js:49:27)",
  "path": "/api/assistants/6778c3a4ecc53bfd8c458163",
  "method": "PUT",
  "body": {
    "name": "美团全能客服",
    "description": "提供专业的客服话术和回复建议，帮助商家高效处理各类客户问题",
    "type": "general",
    "pointsCost": 3,
    "isActive": true,
    "config": {
      "modelType": "coze",
      "apiKey": "pat_gMDZEOZoPKPPcr57dT2lNUGCFjqlkYo67GCcDtFTdYkrW92iXVlcLzVAeXgei92l",
      "temperature": 0.8,
      "maxTokens": 2000,
      "url": "https://api.coze.cn/open_api/v2/chat",
      "bot_id": "7450790638439907355",
      "model": "coze-bot"
    }
  },
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 10:30:32] [31MERROR[39M: Coze API调用失败:
{
  "error": "API调用失败：Requested resource bot_id= does not exist. Ensure you are the correct resource identifier.",
  "stack": "Error: API调用失败：Requested resource bot_id= does not exist. Ensure you are the correct resource identifier.\n    at CozeService.chat (/home/devbox/project/server/services/cozeService.js:73:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
  "config": {
    "modelType": "coze",
    "model": "coze-bot",
    "apiKey": "***",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "temperature": 0.8,
    "maxTokens": 2000
  }
}
[2025-01-04 10:30:45] [31MERROR[39M: 获取AI助手详情失败:
{
  "error": "Cast to ObjectId failed for value \"meituan-service\" (type string) at path \"_id\" for model \"AIAssistant\"",
  "id": "meituan-service"
}
[2025-01-04 10:30:45] [31MERROR[39M: 获取AI助手详情失败: Cast to ObjectId failed for value "meituan-service" (type string) at path "_id" for model "AIAssistant"
{
  "stack": "ApiError: 获取AI助手详情失败: Cast to ObjectId failed for value \"meituan-service\" (type string) at path \"_id\" for model \"AIAssistant\"\n    at AiAssistantService.getAssistantById (/home/devbox/project/server/services/aiAssistant.service.js:167:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.getAssistantById (/home/devbox/project/server/controllers/aiAssistant.controller.js:85:27)",
  "path": "/api/assistants/meituan-service",
  "method": "GET",
  "body": {},
  "user": "677426b8bf3ce254abeac7f4"
}
[2025-01-04 10:31:31] [31MERROR[39M: Coze API调用失败:
{
  "error": "API调用失败：Requested resource bot_id= does not exist. Ensure you are the correct resource identifier.",
  "stack": "Error: API调用失败：Requested resource bot_id= does not exist. Ensure you are the correct resource identifier.\n    at CozeService.chat (/home/devbox/project/server/services/cozeService.js:73:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
  "config": {
    "modelType": "coze",
    "model": "coze-bot",
    "apiKey": "***",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "temperature": 0.8,
    "maxTokens": 2000
  }
}
[2025-01-04 10:34:35] [31MERROR[39M: Coze API调用失败:
{
  "error": "timeout of 30000ms exceeded",
  "stack": "AxiosError: timeout of 30000ms exceeded\n    at RedirectableRequest.handleRequestTimeout (/home/devbox/project/node_modules/axios/dist/node/axios.cjs:3200:16)\n    at RedirectableRequest.emit (node:events:518:28)\n    at Timeout.<anonymous> (/home/devbox/project/node_modules/follow-redirects/index.js:221:12)\n    at listOnTimeout (node:internal/timers:594:17)\n    at process.processTimers (node:internal/timers:529:7)\n    at Axios.request (/home/devbox/project/node_modules/axios/dist/node/axios.cjs:4252:41)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:41:30)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
  "config": {
    "modelType": "coze",
    "model": "coze-bot",
    "apiKey": "***",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "temperature": 0.8,
    "maxTokens": 2000,
    "botId": "7432139594210115595"
  }
}
[2025-01-04 10:39:14] [31MERROR[39M: Coze API调用失败:
{
  "error": "timeout of 30000ms exceeded",
  "stack": "AxiosError: timeout of 30000ms exceeded\n    at RedirectableRequest.handleRequestTimeout (/home/devbox/project/node_modules/axios/dist/node/axios.cjs:3200:16)\n    at RedirectableRequest.emit (node:events:518:28)\n    at Timeout.<anonymous> (/home/devbox/project/node_modules/follow-redirects/index.js:221:12)\n    at listOnTimeout (node:internal/timers:594:17)\n    at process.processTimers (node:internal/timers:529:7)\n    at Axios.request (/home/devbox/project/node_modules/axios/dist/node/axios.cjs:4252:41)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:41:30)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
  "config": {
    "modelType": "coze",
    "model": "coze-bot",
    "apiKey": "***",
    "apiUrl": "https://api.coze.cn/open_api/v2/chat",
    "temperature": 0.8,
    "maxTokens": 2000,
    "botId": "7432139594210115595"
  }
}
[2025-01-04 13:23:42.132] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:23:42.132] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:34)\n    at exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:23:44.135] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:23:44.135] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:23:48.137] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:23:48.137] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:23:48.138] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：无效的Coze配置",
    "stack": "Error: 请求错误：无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:119:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)"
  }
}
[2025-01-04 13:23:48.138] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：无效的Coze配置",
    "attempts": 3
  }
}
[2025-01-04 13:25:18.530] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:25:18.530] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:34)\n    at exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:25:20.532] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:25:20.533] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:25:24.537] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:25:24.537] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:25:24.538] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：无效的Coze配置",
    "stack": "Error: 请求错误：无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:119:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)"
  }
}
[2025-01-04 13:25:24.538] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：无效的Coze配置",
    "attempts": 3
  }
}
[2025-01-04 13:28:00.337] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:28:00.338] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:34)\n    at exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:28:02.340] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:28:02.341] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:28:06.344] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:28:06.344] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:28:06.345] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：无效的Coze配置",
    "stack": "Error: 请求错误：无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:119:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)"
  }
}
[2025-01-04 13:28:06.345] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：无效的Coze配置",
    "attempts": 3
  }
}
[2025-01-04 13:29:37.499] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:29:37.499] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:34)\n    at exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:29:39.502] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:29:39.502] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:29:43.504] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:29:43.505] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:29:43.505] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：无效的Coze配置",
    "stack": "Error: 请求错误：无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:119:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)"
  }
}
[2025-01-04 13:29:43.505] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：无效的Coze配置",
    "attempts": 3
  }
}
[2025-01-04 13:31:46.170] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:31:46.171] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:34)\n    at exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:31:48.173] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:31:48.173] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:31:52.178] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:31:52.178] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:31:52.178] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：无效的Coze配置",
    "stack": "Error: 请求错误：无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:119:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)"
  }
}
[2025-01-04 13:31:52.179] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：无效的Coze配置",
    "attempts": 3
  }
}
[2025-01-04 13:34:57.726] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:34:57.726] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:34)\n    at exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:34:59.728] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:34:59.728] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:35:03.732] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:35:03.732] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:35:03.733] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：无效的Coze配置",
    "stack": "Error: 请求错误：无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:119:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)"
  }
}
[2025-01-04 13:35:03.733] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：无效的Coze配置",
    "attempts": 3
  }
}
[2025-01-04 13:36:04.329] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:36:04.329] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:34)\n    at exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:36:06.332] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:36:06.333] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:36:10.334] ERROR: Coze配置无效:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:36:10.335] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "无效的Coze配置",
    "stack": "Error: 无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:27:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000
    }
  }
}
[2025-01-04 13:36:10.335] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：无效的Coze配置",
    "stack": "Error: 请求错误：无效的Coze配置\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:119:27)\n    at exports.retry (/home/devbox/project/server/utils/helpers.js:144:34)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:127:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:131:24)"
  }
}
[2025-01-04 13:36:10.336] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：无效的Coze配置",
    "attempts": 3
  }
}
[2025-01-04 15:33:02.408] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:33:02.408] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:33:04.488] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:33:04.488] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:33:08.597] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:33:08.598] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:33:08.598] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:33:08.599] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 15:34:08.317] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:34:08.317] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:34:10.411] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:34:10.411] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:34:14.603] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 15:34:14.604] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 15:34:14.604] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 15:34:14.605] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:07:11.742] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:07:11.743] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:07:13.825] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:07:13.825] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:07:17.898] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:07:17.898] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:125:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:07:17.899] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:149:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:157:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:07:17.899] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:08:46.563] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:08:46.564] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:08:48.673] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:08:48.673] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:08:52.771] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:08:52.771] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:08:52.772] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:152:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:08:52.772] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:10:44.434] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:10:44.435] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:10:46.553] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:10:46.553] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:10:50.641] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:10:50.641] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:10:50.642] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:152:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:10:50.642] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:13:53.889] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:13:53.890] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:13:55.967] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:13:55.968] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:14:00.058] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:14:00.058] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:14:00.059] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:152:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:14:00.059] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
[2025-01-04 16:14:27.275] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:14:27.275] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:14:29.377] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:14:29.377] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:14:33.457] ERROR: Coze API调用失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "code": 4000,
    "msg": "The field http body provided is not a valid json or chat request. Please check your input."
  }
}
[2025-01-04 16:14:33.457] ERROR: Coze API调用出错:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:128:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)",
    "config": {
      "modelType": "coze",
      "model": "coze-bot",
      "apiKey": "***",
      "apiUrl": "https://api.coze.cn/open_api/v2/chat",
      "temperature": 0.8,
      "maxTokens": 2000,
      "botId": "7450790638439907355",
      "hasApiKey": true,
      "hasBotId": true,
      "hasApiUrl": true
    }
  }
}
[2025-01-04 16:14:33.458] ERROR: 所有重试尝试都失败
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "totalAttempts": 3,
    "finalError": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "stack": "Error: 请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.\n    at makeRequest (/home/devbox/project/server/services/cozeService.js:152:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.retry (/home/devbox/project/server/utils/helpers.js:144:28)\n    at async CozeService.chat (/home/devbox/project/server/services/cozeService.js:160:28)\n    at async exports.chat (/home/devbox/project/server/controllers/aiAssistant.controller.js:135:24)"
  }
}
[2025-01-04 16:14:33.458] ERROR: Coze API调用最终失败:
Details: {
  "metadata": {
    "service": "ai-assistant-api",
    "error": "请求错误：API调用失败：The field http body provided is not a valid json or chat request. Please check your input.",
    "attempts": 3
  }
}
